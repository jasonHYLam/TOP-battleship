(()=>{"use strict";class s{constructor(s){this.length=s,this.hits=0,this.sunk=!1}setSunk(){this.sunk=!0}hit(){this.hits++}isSunk(){this.length===this.hits&&this.setSunk()}}class t{constructor(){this.hasShip=!1,this.wasGuessed=!1,this.missedHit=!1,this.ship=null}}class i{constructor(){this.grid=function(){let s=[];for(let i=0;i<10;i++){let i=[];for(let s=0;s<10;s++){const s=new t;i.push(s)}s.push(i)}return s}(),this.allShipCoords=[],this.guessedCoords=[]}isOutOfBounds(s,t){return s>9||t>9}checkIfAlreadyPlaced(s,t){return!0===this.grid[t][s].hasShip}populateShipCoordsArray(s,t){this.allShipCoords.push([s,t])}placeShip(t,i,[e,o]){if(this.isOutOfBounds(e,o))return"out of bounds";let r=function(t){if(!(t<1||t>5))return new s(t)}(t);if(r)switch(i){case"horizontal":for(let s=0;s<t;s++){if(this.isOutOfBounds(o,e+s))return"out of bounds";if(this.checkIfAlreadyPlaced(o,e+s))return"position already occupied"}for(let s=0;s<t;s++)this.grid[o][e+s].hasShip=!0,this.grid[o][e+s].ship=r,this.populateShipCoordsArray(e+s,o);break;case"vertical":for(let s=0;s<t;s++){if(this.isOutOfBounds(o+s,e))return"out of bounds";if(this.checkIfAlreadyPlaced(o+s,e))return"position already occupied"}for(let s=0;s<t;s++)this.grid[o+s][e].hasShip=!0,this.grid[o+s][e].ship=r,this.populateShipCoordsArray(e,o+s)}}placeAllShipsOnBoard(){this.placeShip(5,["horizontal","vertical"].Math.round(Math.random()),[Math.floor(10*Math.random()),Math.floor(10*Math.random())])}getPosition(s,t){return this.grid[t][s]}checkShipExists(s,t){return this.grid[t][s].hasShip}getShip(s,t){return this.grid[t][s].ship}checkMissedHit(s,t){return this.grid[t][s].missedHit}checkWasGuessed(s,t){return this.grid[t][s].wasGuessed}checkIsGameOver(){let s=this.allShipCoords.map((s=>JSON.stringify(s))),t=this.guessedCoords.map((s=>JSON.stringify(s)));return console.log(s),console.log(t),console.log(s.every((s=>t.includes(s)))),s.every((s=>t.includes(s)))}receiveAttack(s,t){if(this.checkWasGuessed(s,t))return"already attacked";this.getPosition(s,t).wasGuessed=!0,this.guessedCoords.push([s,t]),this.checkShipExists(s,t)?(this.getShip(s,t).hit(),this.getShip(s,t).isSunk()):this.getPosition(s,t).missedHit=!0}}class e{constructor(s){}attack(s,[t,i]){s.receiveAttack(t,i)}}class o extends e{constructor(){super()}randomAttack(s){const t=Math.floor(10*Math.random()),i=Math.floor(10*Math.random());s.checkWasGuessed(t,i)||this.attack(s,[t,i])}}(function(){let s=new i,t=new i;const r=new e,h=new o;let a=r,c=t,n=!1;function u(){a=a===r?h:r,c=c===s?t:s}function l(s){s.checkIsGameOver()&&(n=!0)}function d(s){s.grid.map((s=>{console.log(s.map((s=>!1===s.hasShip&&!1===s.wasGuessed?"_":!1===s.hasShip&&!0===s.wasGuessed?"m":!0===s.hasShip&&!1===s.wasGuessed?"o":!0===s.hasShip&&!0===s.wasGuessed?"x":void 0)))}))}function p(){let s=JSON.stringify(c.guessedCoords),t=s,i=!1;switch(a){case r:for(;!i;){const e=parseInt(prompt("col to attack")),o=parseInt(prompt("row to attack"));a.attack(c,[e,o]),t=JSON.stringify(c.guessedCoords),s!==t&&(i=!0)}break;case h:for(;!i;)a.randomAttack(c),t=JSON.stringify(c.guessedCoords),s!==t&&(i=!0)}}function f(){switch(a){case r:console.log("player"),d(c),p(),l(c),u();break;case h:console.log("computer"),d(c),p(),l(c),u()}}return s.placeShip(2,"vertical",[1,2]),t.placeShip(2,"vertical",[1,2]),{tryAttackUntilSuccess:p,playGame:function(){for(;!n;)f(),n&&console.log("GAME IS OVER")}}})().playGame()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0FBU2lFLElBRUwsSUFBSUMsRUFBaUI1QixLQUFLQyxVQUFVcUIsRUFBZS9DLGVBQy9Dc0QsRUFBaUJELEVBRWpCRSxHQUFnQixFQUVwQixPQUFRVCxHQUNKLEtBQUtELEVBQ0QsTUFBUVUsR0FBZSxDQUVuQixNQUFNckQsRUFBTXNELFNBQVNDLE9BQU8sa0JBQ3RCL0QsRUFBTThELFNBQVNDLE9BQU8sa0JBQzVCWCxFQUFjVixPQUFPVyxFQUFnQixDQUFDN0MsRUFBS1IsSUFDM0M0RCxFQUFpQjdCLEtBQUtDLFVBQVVxQixFQUFlL0MsZUFDM0NxRCxJQUFtQkMsSUFBZ0JDLEdBQWdCLEVBQzNELENBQ0EsTUFFSixLQUFLcEIsRUFDRCxNQUFRb0IsR0FDSlQsRUFBY04sYUFBYU8sR0FDM0JPLEVBQWlCN0IsS0FBS0MsVUFBVXFCLEVBQWUvQyxlQUMzQ3FELElBQW1CQyxJQUFnQkMsR0FBZ0IsR0FJdkUsQ0FFQSxTQUFTRyxJQUVMLE9BQVFaLEdBQ0osS0FBS0QsRUFDRGpCLFFBQVFDLElBQUksVUFDWnFCLEVBQW1CSCxHQUNuQkssSUFDQS9CLEVBQWdCMEIsR0FDaEJFLElBQ0EsTUFFSixLQUFLZCxFQUNEUCxRQUFRQyxJQUFJLFlBQ1pxQixFQUFtQkgsR0FDbkJLLElBQ0EvQixFQUFnQjBCLEdBQ2hCRSxJQUdSLENBU0EsT0E5RkpOLEVBQWdCdEMsVUFBVSxFQUFHLFdBQVksQ0FBQyxFQUFFLElBTTVDdUMsRUFBa0J2QyxVQUFVLEVBQUcsV0FBWSxDQUFDLEVBQUUsSUF3Rm5DLENBQ0grQyx3QkFDQU8sU0FUUixXQUNJLE1BQVFYLEdBQ0pVLElBQ0lWLEdBQVlwQixRQUFRQyxJQUFJLGVBR3BDLEVBS0osRUN2SEErQixHQUFxQkQsVSIsInNvdXJjZXMiOlsid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL3NoaXAuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL3BsYXllci5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9nYW1lQ29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmNsYXNzIFNoaXAge1xuICAgIC8vIGkgbmVlZCB0byBtYWtlIHN1cmUgbGVuZ3RoIGlzIGJldHdlZW4gMSBhbmQgNFxuICAgIGNvbnN0cnVjdG9yKGxlbmd0aCkge1xuICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDtcbiAgICAgICAgdGhpcy5oaXRzID0gMDtcbiAgICAgICAgdGhpcy5zdW5rID0gZmFsc2U7XG4gICAgfVxuXG4gICAgc2V0U3VuaygpIHtcbiAgICAgICAgdGhpcy5zdW5rID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBoaXQoKSB7XG4gICAgICAgIHRoaXMuaGl0cyArK1xuICAgIH1cblxuICAgIGlzU3VuaygpIHtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSB0aGlzLmhpdHMpIHRoaXMuc2V0U3VuaygpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gaW5pdGlhbGlzZVNoaXAobGVuZ3RoKSB7XG4gICAgaWYgKGxlbmd0aCA8IDEgfHwgbGVuZ3RoID4gNSkgcmV0dXJuIFxuICAgIHJldHVybiBuZXcgU2hpcChsZW5ndGgpXG59XG5cblxuZXhwb3J0IHtpbml0aWFsaXNlU2hpcCwgU2hpcH0iLCJpbXBvcnQgeyBTaGlwLCBpbml0aWFsaXNlU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcblxuY2xhc3MgU3BhY2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmhhc1NoaXAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy53YXNHdWVzc2VkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWlzc2VkSGl0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hpcCA9IG51bGw7XG4gICAgfVxufVxuXG4vLyBub3Qgc3VyZSB3aGVyZSB0byBwdXQgdGhpcyBidXQgbmVlZCB0byBiZSBjYXJlZnVsIGFib3V0IG9yZGluYXRlIG9yZGVyOyBjb2wscm93IHZzIHJvdywgY29sXG4vLyB1c2UgY29sLHJvdyBmb3IgbWV0aG9kIGFyZ3VtZW50cyBhbmQgcHVzaGluZyBpbnRvIHZhcmlhYmxlcyBsaWtlIGd1ZXNzZWRDb29yZHNcbi8vIHVzZSByb3csIGNvbCBmb3IgZ2FtZWJvYXJkIGxvZ2ljXG5jbGFzcyBHYW1lYm9hcmQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBmdW5jdGlvbiBjcmVhdGVHcmlkKCkge1xuICAgICAgICAgICAgbGV0IG5ld0dyaWQgPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpPDEwOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgcm93ID0gW107XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGo8MTA7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzcXVhcmUgPSBuZXcgU3BhY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcm93LnB1c2goc3F1YXJlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuZXdHcmlkLnB1c2gocm93KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ld0dyaWRcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdyaWQgPSBjcmVhdGVHcmlkKCk7XG4gICAgICAgIHRoaXMuYWxsU2hpcENvb3JkcyA9IFtdO1xuICAgICAgICB0aGlzLmd1ZXNzZWRDb29yZHMgPSBbXTtcbiAgICB9XG5cbiAgICBpc091dE9mQm91bmRzKGNvbCwgcm93KSB7XG4gICAgICAgIGlmIChjb2wgPiA5IHx8IHJvdyA+IDkpIHJldHVybiB0cnVlO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY2hlY2tJZkFscmVhZHlQbGFjZWQoY29sLCByb3cpIHtcbiAgICAgICAgaWYgKHRoaXMuZ3JpZFtyb3ddW2NvbF0uaGFzU2hpcCA9PT0gdHJ1ZSkgcmV0dXJuIHRydWU7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwb3B1bGF0ZVNoaXBDb29yZHNBcnJheShjb2wsIHJvdykge1xuICAgICAgICB0aGlzLmFsbFNoaXBDb29yZHMucHVzaChbY29sLCByb3ddKVxuICAgIH1cblxuICAgIHBsYWNlU2hpcChsZW5ndGgsIG9yaWVudGF0aW9uLCBbc3RhcnRDb2wsIHN0YXJ0Um93XSkge1xuXG4gICAgICAgIC8vIHRlc3QgaWYgc3RhcnQgY29vcmQgaXMgb3V0IG9mIGJvdW5kc1xuICAgICAgICBpZiAodGhpcy5pc091dE9mQm91bmRzKHN0YXJ0Q29sLCBzdGFydFJvdykpIHJldHVybiAnb3V0IG9mIGJvdW5kcyc7XG5cbiAgICAgICAgbGV0IG5ld1NoaXAgPSBpbml0aWFsaXNlU2hpcChsZW5ndGgpO1xuICAgICAgICBpZiAoIW5ld1NoaXApIHJldHVybjtcblxuICAgICAgICBzd2l0Y2gob3JpZW50YXRpb24pIHtcbiAgICAgICAgICAgIC8vIGlmIG9yaWVudGF0aW9uIGlzIGhvcml6b250YWxcbiAgICAgICAgICAgIC8vIHN0dWZmIGhhcHBlbnMgZnJvbSBsZWZ0IHRvIHJpZ2h0XG4gICAgICAgICAgICBjYXNlICdob3Jpem9udGFsJzpcbiAgICAgICAgICAgICAgICAvL2xvb3AgZm9yIGxlbmd0aCBhbmQgY2hlY2sgaWYgb3V0IG9mIGJvdW5kcyBvciBhbHJlYWR5IG9jY3VwaWVkOyBpZiBzbyBjYW5jZWwgZXhlY3V0aW9uXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGk8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT3V0T2ZCb3VuZHMoc3RhcnRSb3csIHN0YXJ0Q29sICsgaSkpIHJldHVybiAnb3V0IG9mIGJvdW5kcyc7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrSWZBbHJlYWR5UGxhY2VkKHN0YXJ0Um93LCBzdGFydENvbCArIGkpKSByZXR1cm4gJ3Bvc2l0aW9uIGFscmVhZHkgb2NjdXBpZWQnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGVsc2UsIGxvb3AgYWxvbmcgdGhlIHJvdyAob2NjdXB5IGNvbHVtbnMgb2YgdGhlIHNhbWUgcm93KVxuICAgICAgICAgICAgICAgIC8vIGF0IGVhY2ggZ3JpZCBzcXVhcmUsIG9jY3VweSB3aXRoIHNoaXAgSURcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaTwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRbc3RhcnRSb3ddW3N0YXJ0Q29sICsgaV0uaGFzU2hpcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgLy8gdGhpcyBtYXkgYmUgbm90IGdvb2RcbiAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRbc3RhcnRSb3ddW3N0YXJ0Q29sICsgaV0uc2hpcCA9IG5ld1NoaXA7XG5cbiAgICAgICAgICAgICAgICAgICAvLyBtYXkgYmUgYW4gZXJyb3IgaW4gdGhlIGNvbCBhbmQgcm93IGFyZ3VtZW50IG9yZGVyXG4gICAgICAgICAgICAgICAgICAgLy9ub3QgdW5kZXJzdGFuZC4uLlxuICAgICAgICAgICAgICAgICAgIC8vIGNoYW5nZSB0aGlzIGZyb20gc3BhY2VzLCB0byBjb29yZGluYXRlcywgY3VzIGkgZG9uJ3Qgd2FudCBhIGNvcHkgb2Ygb2JqZWN0c1xuICAgICAgICAgICAgICAgICAgIHRoaXMucG9wdWxhdGVTaGlwQ29vcmRzQXJyYXkoc3RhcnRDb2wgKyBpLCBzdGFydFJvdylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgICAgLy8gaWYgb3JpZW50YXRpb24gaXMgdmVydGljYWxcbiAgICAgICAgICAgIC8vIHNoaXAgaXMgY3JlYXRlZCBmcm9tIGJvdHRvbSB0byB0b3BcbiAgICAgICAgICAgIC8vIHJvd1swXSBpcyBib3R0b20sIHJvd1s5XSB0byB0b3AsIGR1ZSB0byB0aGUgYDkgLSBgXG4gICAgICAgICAgICBjYXNlICd2ZXJ0aWNhbCc6XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGk8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT3V0T2ZCb3VuZHMoc3RhcnRSb3cgKyBpLCBzdGFydENvbCkpIHJldHVybiAnb3V0IG9mIGJvdW5kcydcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tJZkFscmVhZHlQbGFjZWQoc3RhcnRSb3cgKyBpLCBzdGFydENvbCkpIHJldHVybiAncG9zaXRpb24gYWxyZWFkeSBvY2N1cGllZCdcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBhbmQgdGhlbiBwdXQgc3R1ZmYgYWxvbmcgdGhlIGNvbHVtbiAob2NjdXB5IHJvd3Mgb2YgdGhlIHNhbWUgY29sdW1uKVxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRbc3RhcnRSb3cgKyBpXVtzdGFydENvbF0uaGFzU2hpcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFtzdGFydFJvdyArIGldW3N0YXJ0Q29sXS5zaGlwID0gbmV3U2hpcDtcblxuICAgICAgICAgICAgICAgICAgIC8vIG1heSBiZSBhbiBlcnJvciBpbiB0aGUgY29sIGFuZCByb3cgYXJndW1lbnQgb3JkZXJcbiAgICAgICAgICAgICAgICAgICAvLyBjaGFuZ2UgdGhpcyBmcm9tIHNwYWNlcywgdG8gY29vcmRpbmF0ZXMsIGN1cyBpIGRvbid0IHdhbnQgYSBjb3B5IG9mIG9iamVjdHNcbiAgICAgICAgICAgICAgICAgICB0aGlzLnBvcHVsYXRlU2hpcENvb3Jkc0FycmF5KHN0YXJ0Q29sLCBzdGFydFJvdyArIGkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB3aGF0IGRvIGkgcGxhY2Ugb24gdGhlIGJvYXJkP1xuICAgIC8vIDUgcGllY2VzIGkgdGhpbmtcbiAgICAvLyBobW0gaG93IGRvIGkga2VlcCB0cnlpbmcgdG8gcGxhY2UgdGhlIHNoaXBzIGlmIHRoZXkgYXJlIG91dCBvZiBib3VuZHMgb3IgYWxyZWFkeSBwYWxjZWQ/XG4gICAgLy8gc2hvdWxkIGkganVzdCBwdXQgZWFjaCBpbiBhIHdoaWxlIGxvb3A/IG9yIHVzZSByZWN1cnNpb24/XG5cbiAgICBwbGFjZUFsbFNoaXBzT25Cb2FyZCgpIHtcbiAgICAgICAgLy8gbmVlZCB0byBwdXQgc2hpcHMgaG9yaXpvbnRhbGx5IG9yIHZlcnRpY2FsbHkgcmFuZG9tbHlcbiAgICAgICAgLy8gdGhpcyB3aWxsIG9ubHkgZ2VuZXJhdGUgb25lIG9yaWVudGF0aW9uLi4uIG1ha2UgaXQgYSBzZXBhcmF0ZSBmdW5jdGlvblxuICAgICAgICBmdW5jdGlvbiBnZW5lcmF0ZVJhbmRvbU9yaWVudGF0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIFsnaG9yaXpvbnRhbCcsICd2ZXJ0aWNhbCddLk1hdGgucm91bmQoTWF0aC5yYW5kb20oKSlcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlUmFuZG9tQ29vcmRpbmF0ZXMoKSB7XG4gICAgICAgICAgICBjb25zdCByYW5kb21Db2wgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMClcbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbVJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxuICAgICAgICAgICAgcmV0dXJuIFtyYW5kb21Db2wsIHJhbmRvbVJvd11cbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy9ob3cgZG8gaSBwcmV2ZW50IGZhaWx1cmUgdG8gcGxhY2UgYSBzaGlwPyBpcyBpdCBcbiAgICAgICAgLy8gdGhlcmUgYXJlIHNldmVyYWwgb3B0aW9ucy4uLiBcbiAgICAgICAgLy8gd2hpbGUgKCkge31cbiAgICAgICAgdGhpcy5wbGFjZVNoaXAoNSwgZ2VuZXJhdGVSYW5kb21PcmllbnRhdGlvbigpLCBnZW5lcmF0ZVJhbmRvbUNvb3JkaW5hdGVzKCkpXG5cbiAgICB9XG5cbiAgICBnZXRQb3NpdGlvbihjb2wsIHJvdykge1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkW3Jvd11bY29sXVxuICAgIH1cblxuICAgIGNoZWNrU2hpcEV4aXN0cyhjb2wsIHJvdykge1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkW3Jvd11bY29sXS5oYXNTaGlwXG4gICAgfVxuXG5cbiAgICBnZXRTaGlwKGNvbCwgcm93KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWRbcm93XVtjb2xdLnNoaXBcbiAgICB9XG5cbiAgICBjaGVja01pc3NlZEhpdChjb2wsIHJvdykge1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkW3Jvd11bY29sXS5taXNzZWRIaXRcbiAgICB9XG5cbiAgICBjaGVja1dhc0d1ZXNzZWQoY29sLCByb3cpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JpZFtyb3ddW2NvbF0ud2FzR3Vlc3NlZFxuICAgIH1cblxuICAgIC8vIGNvbXBhcmUgc3RyaW5naWZpZWQgc2hpcCBjb29yZHMgdG8gdGhlIGd1ZXNzZWQgY29vcmRzLCBhbmQgcmV0dXJuIHRydWUgaWYgYWxsIHNoaXAgY29vcmRzIGFyZSBndWVzc2VkLlxuICAgIGNoZWNrSXNHYW1lT3ZlcigpIHtcbiAgICAgICAgbGV0IGNvbnZlcnRlZEFsbFNoaXBDb29yZHMgPSB0aGlzLmFsbFNoaXBDb29yZHMubWFwKGNvb3JkID0+IEpTT04uc3RyaW5naWZ5KGNvb3JkKSlcbiAgICAgICAgbGV0IGNvbnZlcnRlZEd1ZXNzZWRDb29yZHMgPSB0aGlzLmd1ZXNzZWRDb29yZHMubWFwKGNvb3JkID0+SlNPTi5zdHJpbmdpZnkoY29vcmQpKVxuICAgICAgICBjb25zb2xlLmxvZyhjb252ZXJ0ZWRBbGxTaGlwQ29vcmRzKVxuICAgICAgICBjb25zb2xlLmxvZyhjb252ZXJ0ZWRHdWVzc2VkQ29vcmRzKVxuICAgICAgICAvLyBpZiAoY29udmVydGVkQWxsU2hpcENvb3Jkcy5ldmVyeShzaGlwQ29vcmQgPT4gY29udmVydGVkR3Vlc3NlZENvb3Jkcy5pbmNsdWRlcyhzaGlwQ29vcmQpKSkge1xuICAgICAgICAvLyAgICAgdGhpcy5pc0dhbWVPdmVyID0gdHJ1ZTtcbiAgICAgICAgLy8gfVxuICAgICAgICBjb25zb2xlLmxvZyhjb252ZXJ0ZWRBbGxTaGlwQ29vcmRzLmV2ZXJ5KHNoaXBDb29yZCA9PiBjb252ZXJ0ZWRHdWVzc2VkQ29vcmRzLmluY2x1ZGVzKHNoaXBDb29yZCkpKVxuICAgICAgICByZXR1cm4gY29udmVydGVkQWxsU2hpcENvb3Jkcy5ldmVyeShzaGlwQ29vcmQgPT4gY29udmVydGVkR3Vlc3NlZENvb3Jkcy5pbmNsdWRlcyhzaGlwQ29vcmQpKVxuICAgIH1cblxuICAgIHJlY2VpdmVBdHRhY2soY29sLCByb3cpIHtcbiAgICAgICAgLy8gZmlyc3QsIGNoZWNrIGlmIHBvc2l0aW9uIGlzIGFscmVhZHkgZ3Vlc3NlZFxuICAgICAgICBpZiAodGhpcy5jaGVja1dhc0d1ZXNzZWQoY29sLCByb3cpKSByZXR1cm4gJ2FscmVhZHkgYXR0YWNrZWQnO1xuICAgICAgICAvLyBpZiBub3QgZ3Vlc3NlZCwgdGhlbiBtYXJrIGFzIGd1ZXNzZWRcbiAgICAgICAgdGhpcy5nZXRQb3NpdGlvbihjb2wsIHJvdykud2FzR3Vlc3NlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuZ3Vlc3NlZENvb3Jkcy5wdXNoKFtjb2wsIHJvd10pXG5cbiAgICAgICAgLy8gaWYgbm90LCBjaGVjayBpZiB0aGVyZSBpcyBhIHNoaXAgdGhlcmVcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tTaGlwRXhpc3RzKGNvbCwgcm93KSkge1xuICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMsIHRoZW4gaWRlbnRpZnkgdGhlIHNoaXBcbiAgICAgICAgICAgIC8vIHRoZW4gaGl0IHRoZSBzaGlwXG4gICAgICAgICAgICB0aGlzLmdldFNoaXAoY29sLCByb3cpLmhpdCgpXG4gICAgICAgICAgICAvLyB0aGVuIGNoZWNrIGlmIHNoaXAgaXMgc3Vua1xuICAgICAgICAgICAgdGhpcy5nZXRTaGlwKGNvbCwgcm93KS5pc1N1bmsoKTtcblxuICAgICAgICAgICAgLy8gdGhlbiBjaGVjayBpZiBhbGwgc2hpcHMgYXJlIGhpdCwgYnkgY29tcGFyaW5nIGFsbFNoaXBDb29yZHMgYW5kIGd1ZXNzZWRDb29yZHMgYXJyYXlzIFxuICAgICAgICAgICAgLy8gdGhpcy5jaGVja0lzR2FtZU92ZXIoKTtcblxuICAgICAgICB9XG4gICAgICAgIC8vIGlmIHRoZXJlIGlzbid0IGEgc2hpcCwgdGhlbiBtYXJrIHRoZSBwbGFjZSB3aXRoIG1pc3NlZEhpdFxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0UG9zaXRpb24oY29sLCByb3cpLm1pc3NlZEhpdCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBcbn1cbmV4cG9ydCB7R2FtZWJvYXJkfSIsImV4cG9ydCBjbGFzcyBQbGF5ZXIge1xuICAgIGNvbnN0cnVjdG9yKGNvbXB1dGVyKSB7XG4gICAgfVxuXG4gICAgLy8gaG1tIGlzIHRoaXMgb2theT8gZG8gaSBuZWVkIHRvIGltcG9ydCBnYW1lYm9hcmQ/IHN1cmVseSBub3QuLi4gdGhhdCB3b3VsZCBiZSBhd2Z1bFxuICAgIC8vIGkganVzdCBjYWxsZWQgdGhlIHJlY2VpdmVBdHRhY2sgbWV0aG9kIG9uIHRoZSBnYW1lYm9hcmQgYXJndW1lbnQuLi4gaXMgdGhpcyBhIGJhZCB0aGluZz9cbiAgICBhdHRhY2soZ2FtZWJvYXJkLCBbY29sLCByb3ddKSB7XG4gICAgICAgIGdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvbCwgcm93KVxuICAgIH1cblxuICAgIC8vIGFjdHVhbGx5IHRoaXMgY2FuJ3QgYmUgaW4gaGVyZS4uLiBjdXMgdGhlIGNvbCBhbmQgcm93IGRvbid0IGNoYW5nZS4uLiB0aGV5IGdvdHRhIGNoYW5nZVxuICAgIC8vIHRyeUF0dGFja1VudGlsU3VjY2VzcyhnYW1lYm9hcmQsIFtjb2wsIHJvd10pIHtcbiAgICAvLyAgICAgbGV0IGluaXRpYWxHdWVzc2VzID0gSlNPTi5zdHJpbmdpZnkoZ2FtZWJvYXJkLmd1ZXNzZWRDb29yZHMpXG4gICAgLy8gICAgIGxldCBjdXJyZW50R3Vlc3NlcztcbiAgICAvLyAgICAgd2hpbGUgKGluaXRpYWxHdWVzc2VzICE9PSBjdXJyZW50R3Vlc3Nlcykge1xuICAgIC8vICAgICAgICAgdGhpcy5hdHRhY2soZ2FtZWJvYXJkLCBbY29sLCByb3ddKVxuICAgIC8vICAgICAgICAgY3VycmVudEd1ZXNzZXMgPSBKU09OLnN0cmluZ2lmeShnYW1lYm9hcmQuZ3Vlc3NlZENvb3JkcylcbiAgICAvLyAgICAgfVxuICAgIC8vIH1cbn1cblxuLy8gYWhoaCBkb24ndCB0aGluayB0aGlzIHdvcmtzLCwsIGdvdHRhIHVzZSBzdXBlcj9cbmV4cG9ydCBjbGFzcyBDb21wdXRlciBleHRlbmRzIFBsYXllciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKClcbiAgICB9XG5cbiAgICByYW5kb21BdHRhY2soZ2FtZWJvYXJkKSB7XG4gICAgICAgIC8vIHRha2UgcmFuZG9tIG51bWJlcnMgZm9yIGNvbHVtbiBhbmQgcm93XG4gICAgICAgIGNvbnN0IHJhbmRvbUNvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxuICAgICAgICBjb25zdCByYW5kb21Sb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMClcblxuICAgICAgICAvL3RoZW4gY2hlY2sgaWYgaGFzIGJlZW4gYXR0YWNrZWQsXG4gICAgICAgIGlmKGdhbWVib2FyZC5jaGVja1dhc0d1ZXNzZWQocmFuZG9tQ29sLCByYW5kb21Sb3cpKSByZXR1cm5cblxuICAgICAgICAvL3RoZW4gY2FsbCBhdHRhY2tcbiAgICAgICAgdGhpcy5hdHRhY2soZ2FtZWJvYXJkLCBbcmFuZG9tQ29sLCByYW5kb21Sb3ddKVxuICAgIH1cbn0iLCJpbXBvcnQgeyBHYW1lYm9hcmQgfSBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcbmltcG9ydCB7IFBsYXllciwgQ29tcHV0ZXIgfSBmcm9tIFwiLi9wbGF5ZXJcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VHYW1lQ29udHJvbGxlcigpIHtcbiAgICAvLyBhdCBzb21lIHBvaW50LCB3aWxsIG5lZWQgdG8gZGV2ZWxvcCBmdW5jdGlvbiB0byBwbGFjZUFsbFNoaXBzLCB3aGljaCBcbiAgICAvLyBuZWVkcyB0byBnZXQgYXJvdW5kIHRoZSBwcm9ibGVtIG9mIGxvb3BpbmcgcGxhY2VTaGlwIHVudGlsIGl0IGlzIGFjdHVhbGx5IHBsYWNlZFxuXG4gICAgbGV0IHBsYXllckdhbWVib2FyZCA9IG5ldyBHYW1lYm9hcmQoKTtcbiAgICBsZXQgY29tcHV0ZXJHYW1lYm9hcmQgPSBuZXcgR2FtZWJvYXJkKCk7XG5cbiAgICBjb25zdCBwbGF5ZXIgPSBuZXcgUGxheWVyKCk7XG4gICAgY29uc3QgY29tcHV0ZXIgPSBuZXcgQ29tcHV0ZXIoKTtcblxuICAgIGxldCBjdXJyZW50UGxheWVyID0gcGxheWVyO1xuICAgIGxldCBlbmVteUdhbWVib2FyZCA9IGNvbXB1dGVyR2FtZWJvYXJkXG5cbiAgICBsZXQgaXNHYW1lT3ZlciA9IGZhbHNlO1xuXG4gICAgLy8gd2FpdCwgaXMgdGhpcyBtb2NraW5nPyBpdCBtYXkgYmUgd29ydGggYSByZWFkIGFnYWluLi4uXG4gICAgLy8gcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcCg1LCAndmVydGljYWwnLCBbOSw2XSk7XG4gICAgLy8gcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcCg0LCAnaG9yaXpvbnRhbCcsIFswLDhdKTtcbiAgICAvLyBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDMsICd2ZXJ0aWNhbCcsIFs1LDZdKTtcbiAgICAvLyBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDMsICdob3Jpem9udGFsJywgWzIsM10pO1xuICAgIHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoMiwgJ3ZlcnRpY2FsJywgWzEsMl0pO1xuXG4gICAgLy8gY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDUsICd2ZXJ0aWNhbCcsIFs5LDNdKTtcbiAgICAvLyBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoNCwgJ2hvcml6b250YWwnLCBbMCw4XSk7XG4gICAgLy8gY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDMsICd2ZXJ0aWNhbCcsIFs1LDZdKTtcbiAgICAvLyBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoMywgJ2hvcml6b250YWwnLCBbMiwzXSk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDIsICd2ZXJ0aWNhbCcsIFsxLDJdKTtcblxuICAgIC8vIHdpbGwgbmVlZCB0byB0ZXN0IGVhY2ggb2YgdGhlc2UuLi5cbiAgICBmdW5jdGlvbiBzd2FwUGxheWVyQW5kRW5lbXkoKSB7XG4gICAgICAgIGN1cnJlbnRQbGF5ZXIgPT09IHBsYXllciA/IGN1cnJlbnRQbGF5ZXIgPSBjb21wdXRlciA6IGN1cnJlbnRQbGF5ZXIgPSBwbGF5ZXI7XG4gICAgICAgIGVuZW15R2FtZWJvYXJkID09PSBwbGF5ZXJHYW1lYm9hcmQgPyBlbmVteUdhbWVib2FyZCA9IGNvbXB1dGVyR2FtZWJvYXJkIDogZW5lbXlHYW1lYm9hcmQgPSBwbGF5ZXJHYW1lYm9hcmQ7XG4gICAgfVxuXG4gICAgLy8gaWYgZ2FtZSBpcyBvdmVyLCBzZXQgdGhlIGlzR2FtZU92ZXIgdmFyaWFibGUgdG8gdHJ1ZSB0byBlbmQgdGhlIHdoaWxlIGxvb3AuXG4gICAgZnVuY3Rpb24gY2hlY2tJc0dhbWVPdmVyKGdhbWVib2FyZCkge1xuICAgICAgICBpZiAoZ2FtZWJvYXJkLmNoZWNrSXNHYW1lT3ZlcigpKSBpc0dhbWVPdmVyID0gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgZnVuY3Rpb24gdmlzdWFsaXNlR2FtZWJvYXJkKGdhbWVib2FyZCkge1xuICAgICAgICAvLyBob3cgZG8gaSBjb252ZXJ0IHRoZSBnYW1lYm9hcmQgd2l0aCB0aGUgc3BhY2VzLCBpbnRvIGEgY29uc29sZSBsb2c/XG4gICAgICAgIC8vIG1heWJlIGEgZG91YmxlIG1hcFxuICAgICAgICBnYW1lYm9hcmQuZ3JpZC5tYXAocm93ID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgcm93Lm1hcChzcGFjZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYoc3BhY2UuaGFzU2hpcCA9PT0gZmFsc2UgJiYgc3BhY2Uud2FzR3Vlc3NlZCA9PT0gZmFsc2UpIHJldHVybiAnXydcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChzcGFjZS5oYXNTaGlwID09PSBmYWxzZSAmJiBzcGFjZS53YXNHdWVzc2VkID09PSB0cnVlKSByZXR1cm4gJ20nXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoc3BhY2UuaGFzU2hpcCA9PT0gdHJ1ZSAmJiBzcGFjZS53YXNHdWVzc2VkID09PSBmYWxzZSkgcmV0dXJuICdvJ1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNwYWNlLmhhc1NoaXAgPT09IHRydWUgJiYgc3BhY2Uud2FzR3Vlc3NlZCA9PT0gdHJ1ZSkgcmV0dXJuICd4J1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBjaGVjayBpZiB0aGUgZ3Vlc3NlZENvb3JkcyBhcnJheSBjaGFuZ2VzOyBpZiBzbywgdGhlIGF0dGFjayB3YXMgc3VjY2Vzc2Z1bC5cbiAgICAvLyB0aGlzIGFic29sdXRlbHkgbXVzdCBnZXQgdGVzdGVkLi4uXG4gICAgZnVuY3Rpb24gdHJ5QXR0YWNrVW50aWxTdWNjZXNzKCkge1xuXG4gICAgICAgIGxldCBpbml0aWFsR3Vlc3NlcyA9IEpTT04uc3RyaW5naWZ5KGVuZW15R2FtZWJvYXJkLmd1ZXNzZWRDb29yZHMpXG4gICAgICAgIGxldCBjdXJyZW50R3Vlc3NlcyA9IGluaXRpYWxHdWVzc2VzO1xuXG4gICAgICAgIGxldCB2YWxpZFBsYXlNYWRlID0gZmFsc2U7XG5cbiAgICAgICAgc3dpdGNoIChjdXJyZW50UGxheWVyKSB7XG4gICAgICAgICAgICBjYXNlIHBsYXllcjpcbiAgICAgICAgICAgICAgICB3aGlsZSAoIXZhbGlkUGxheU1hZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbGV0IFtjb2wsIHJvd10gPSBwcm9tcHQoJ2Nvb3JkcyB0byBhdHRhY2ssIGluIFwieCx5XCInKS5zcGxpdChcIixcIilcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sID0gcGFyc2VJbnQocHJvbXB0KCdjb2wgdG8gYXR0YWNrJykpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByb3cgPSBwYXJzZUludChwcm9tcHQoJ3JvdyB0byBhdHRhY2snKSk7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXIuYXR0YWNrKGVuZW15R2FtZWJvYXJkLCBbY29sLCByb3ddKVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50R3Vlc3NlcyA9IEpTT04uc3RyaW5naWZ5KGVuZW15R2FtZWJvYXJkLmd1ZXNzZWRDb29yZHMpXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbml0aWFsR3Vlc3NlcyAhPT0gY3VycmVudEd1ZXNzZXMpIHZhbGlkUGxheU1hZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBjb21wdXRlcjpcbiAgICAgICAgICAgICAgICB3aGlsZSAoIXZhbGlkUGxheU1hZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFBsYXllci5yYW5kb21BdHRhY2soZW5lbXlHYW1lYm9hcmQpXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRHdWVzc2VzID0gSlNPTi5zdHJpbmdpZnkoZW5lbXlHYW1lYm9hcmQuZ3Vlc3NlZENvb3JkcylcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxHdWVzc2VzICE9PSBjdXJyZW50R3Vlc3NlcykgdmFsaWRQbGF5TWFkZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcGxheVJvdW5kKCkge1xuXG4gICAgICAgIHN3aXRjaCAoY3VycmVudFBsYXllcikge1xuICAgICAgICAgICAgY2FzZSBwbGF5ZXI6XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3BsYXllcicpXG4gICAgICAgICAgICAgICAgdmlzdWFsaXNlR2FtZWJvYXJkKGVuZW15R2FtZWJvYXJkKTtcbiAgICAgICAgICAgICAgICB0cnlBdHRhY2tVbnRpbFN1Y2Nlc3MoKVxuICAgICAgICAgICAgICAgIGNoZWNrSXNHYW1lT3ZlcihlbmVteUdhbWVib2FyZCk7XG4gICAgICAgICAgICAgICAgc3dhcFBsYXllckFuZEVuZW15KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNhc2UgY29tcHV0ZXI6XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvbXB1dGVyJylcbiAgICAgICAgICAgICAgICB2aXN1YWxpc2VHYW1lYm9hcmQoZW5lbXlHYW1lYm9hcmQpO1xuICAgICAgICAgICAgICAgIHRyeUF0dGFja1VudGlsU3VjY2VzcygpO1xuICAgICAgICAgICAgICAgIGNoZWNrSXNHYW1lT3ZlcihlbmVteUdhbWVib2FyZCk7XG4gICAgICAgICAgICAgICAgc3dhcFBsYXllckFuZEVuZW15KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIGZ1bmN0aW9uIHBsYXlHYW1lKCkge1xuICAgICAgICB3aGlsZSAoIWlzR2FtZU92ZXIpIHtcbiAgICAgICAgICAgIHBsYXlSb3VuZCgpXG4gICAgICAgICAgICBpZiAoaXNHYW1lT3ZlcikgY29uc29sZS5sb2coJ0dBTUUgSVMgT1ZFUicpXG4gICAgICAgIH1cblxuICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRyeUF0dGFja1VudGlsU3VjY2VzcyxcbiAgICAgICAgICAgIHBsYXlHYW1lLFxuICAgICAgICB9XG59IiwiaW1wb3J0IHsgbWFrZUdhbWVDb250cm9sbGVyIH0gZnJvbSBcIi4vZ2FtZUNvbnRyb2xsZXJcIjtcblxubWFrZUdhbWVDb250cm9sbGVyKCkucGxheUdhbWUoKSJdLCJuYW1lcyI6WyJTaGlwIiwiY29uc3RydWN0b3IiLCJsZW5ndGgiLCJ0aGlzIiwiaGl0cyIsInN1bmsiLCJzZXRTdW5rIiwiaGl0IiwiaXNTdW5rIiwiU3BhY2UiLCJoYXNTaGlwIiwid2FzR3Vlc3NlZCIsIm1pc3NlZEhpdCIsInNoaXAiLCJHYW1lYm9hcmQiLCJncmlkIiwibmV3R3JpZCIsImkiLCJyb3ciLCJqIiwic3F1YXJlIiwicHVzaCIsImNyZWF0ZUdyaWQiLCJhbGxTaGlwQ29vcmRzIiwiZ3Vlc3NlZENvb3JkcyIsImlzT3V0T2ZCb3VuZHMiLCJjb2wiLCJjaGVja0lmQWxyZWFkeVBsYWNlZCIsInBvcHVsYXRlU2hpcENvb3Jkc0FycmF5IiwicGxhY2VTaGlwIiwib3JpZW50YXRpb24iLCJzdGFydENvbCIsInN0YXJ0Um93IiwibmV3U2hpcCIsImluaXRpYWxpc2VTaGlwIiwicGxhY2VBbGxTaGlwc09uQm9hcmQiLCJNYXRoIiwicm91bmQiLCJyYW5kb20iLCJmbG9vciIsImdldFBvc2l0aW9uIiwiY2hlY2tTaGlwRXhpc3RzIiwiZ2V0U2hpcCIsImNoZWNrTWlzc2VkSGl0IiwiY2hlY2tXYXNHdWVzc2VkIiwiY2hlY2tJc0dhbWVPdmVyIiwiY29udmVydGVkQWxsU2hpcENvb3JkcyIsIm1hcCIsImNvb3JkIiwiSlNPTiIsInN0cmluZ2lmeSIsImNvbnZlcnRlZEd1ZXNzZWRDb29yZHMiLCJjb25zb2xlIiwibG9nIiwiZXZlcnkiLCJzaGlwQ29vcmQiLCJpbmNsdWRlcyIsInJlY2VpdmVBdHRhY2siLCJQbGF5ZXIiLCJjb21wdXRlciIsImF0dGFjayIsImdhbWVib2FyZCIsIkNvbXB1dGVyIiwic3VwZXIiLCJyYW5kb21BdHRhY2siLCJyYW5kb21Db2wiLCJyYW5kb21Sb3ciLCJwbGF5ZXJHYW1lYm9hcmQiLCJjb21wdXRlckdhbWVib2FyZCIsInBsYXllciIsImN1cnJlbnRQbGF5ZXIiLCJlbmVteUdhbWVib2FyZCIsImlzR2FtZU92ZXIiLCJzd2FwUGxheWVyQW5kRW5lbXkiLCJ2aXN1YWxpc2VHYW1lYm9hcmQiLCJzcGFjZSIsInRyeUF0dGFja1VudGlsU3VjY2VzcyIsImluaXRpYWxHdWVzc2VzIiwiY3VycmVudEd1ZXNzZXMiLCJ2YWxpZFBsYXlNYWRlIiwicGFyc2VJbnQiLCJwcm9tcHQiLCJwbGF5Um91bmQiLCJwbGF5R2FtZSIsIm1ha2VHYW1lQ29udHJvbGxlciJdLCJzb3VyY2VSb290IjoiIn0=