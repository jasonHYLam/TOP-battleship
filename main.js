(()=>{"use strict";class s{constructor(s){this.length=s,this.hits=0,this.sunk=!1}setSunk(){this.sunk=!0}hit(){this.hits++}isSunk(){this.length===this.hits&&this.setSunk()}}class t{constructor(){this.hasShip=!1,this.wasGuessed=!1,this.missedHit=!1,this.ship=null}}class i{constructor(){this.grid=function(){let s=[];for(let i=0;i<10;i++){let i=[];for(let s=0;s<10;s++){const s=new t;i.push(s)}s.push(i)}return s}(),this.allShipCoords=[],this.guessedCoords=[]}isOutOfBounds(s,t){return s>9||t>9}checkIfAlreadyPlaced(s,t){return!0===this.grid[t][s].hasShip}populateShipCoordsArray(s,t){this.allShipCoords.push([s,t])}placeShip(t,i,[e,r]){if(this.isOutOfBounds(e,r))return"out of bounds";let h=function(t){if(!(t<1||t>5))return new s(t)}(t);if(h)switch(i){case"horizontal":for(let s=0;s<t;s++){if(this.isOutOfBounds(9-r,e+s))return"out of bounds";if(this.checkIfAlreadyPlaced(9-r,e+s))return"position already occupied"}for(let s=0;s<t;s++)this.grid[9-r][e+s].hasShip=!0,this.grid[9-r][e+s].ship=h,this.populateShipCoordsArray(e+s,r);break;case"vertical":for(let s=0;s<t;s++){if(this.isOutOfBounds(9-r+s,e))return"out of bounds";if(this.checkIfAlreadyPlaced(9-r+s,e))return"position already occupied"}for(let s=0;s<t;s++)this.grid[9-r+s][e].hasShip=!0,this.grid[9-r+s][e].ship=h,this.populateShipCoordsArray(e,r+s)}}placeAllShipsOnBoard(){this.placeShip(5,["horizontal","vertical"].Math.round(Math.random()),[Math.floor(10*Math.random()),Math.floor(10*Math.random())])}getPosition(s,t){return this.grid[t][s]}checkShipExists(s,t){return this.grid[t][s].hasShip}getShip(s,t){return this.grid[t][s].ship}checkMissedHit(s,t){return this.grid[t][s].missedHit}checkWasGuessed(s,t){return this.grid[t][s].wasGuessed}checkIsGameOver(){let s=this.allShipCoords.map((s=>JSON.stringify(s))),t=this.guessedCoords.map((s=>JSON.stringify(s)));return s.every((s=>t.includes(s)))}receiveAttack(s,t){if(this.checkWasGuessed(s,t))return"already attacked";this.getPosition(s,t).wasGuessed=!0,this.guessedCoords.push([s,t]),this.checkShipExists(s,t)?(this.getShip(s,t).hit(),this.getShip(s,t).isSunk()):this.getPosition(s,t).missedHit=!0}}class e{constructor(s){}attack(s,[t,i]){s.receiveAttack(t,i)}tryAttackUntilSuccess(s,[t,i]){let e,r=JSON.stringify(s.guessedCoords);for(;r!==e;)this.attack(s,[t,i]),e=JSON.stringify(s.guessedCoords)}}class r extends e{constructor(){super()}randomAttack(s){const t=Math.floor(10*Math.random()),i=Math.floor(10*Math.random());s.checkWasGuessed(t,i)||this.attack(s,[t,i])}}(function(){let s=new i,t=new i;const h=new e,a=new r;let o=h,c=t,n=!1;function l(s){s.checkIsGameOver()&&(n=!0)}function u(s){s.grid.map((s=>{console.log(s.map((s=>!1===s.hasShip&&!1===s.wasGuessed?"_":!1===s.hasShip&&!0===s.wasGuessed?"m":!0===s.hasShip&&!1===s.wasGuessed?"o":!0===s.hasShip&&!0===s.wasGuessed?"x":void 0)))}))}function d(){switch(o){case h:console.log("player"),u(c),l(c),swapPlayer();break;case a:console.log("computer"),u(),l(c),swapPlayer()}}return s.placeShip(5,"vertical",[9,6]),s.placeShip(4,"horizontal",[0,8]),s.placeShip(3,"vertical",[5,6]),s.placeShip(3,"horizontal",[2,3]),s.placeShip(2,"vertical",[1,2]),t.placeShip(5,"vertical",[9,6]),t.placeShip(4,"horizontal",[0,8]),t.placeShip(3,"vertical",[5,6]),t.placeShip(3,"horizontal",[2,3]),t.placeShip(2,"vertical",[1,2]),{tryAttackUntilSuccess:function(s,t){let i,e=JSON.stringify(c.guessedCoords);switch(o){case h:for(;e===i;)o.attack(c,[s,t]),i=JSON.stringify(c.guessedCoords);break;case h:for(;e!==i;)o.randomAttack(c),i=JSON.stringify(c.guessedCoords)}},playGame:function(){for(;!n;)d()}}})().playGame()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UXdELFNBUlIsV0FDSSxNQUFRUCxHQUNKSyxHQUdSLEVBS0osRUNsSUFHLEdBQXFCRCxVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvc2hpcC5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL2dhbWVDb250cm9sbGVyLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlxuY2xhc3MgU2hpcCB7XG4gICAgLy8gaSBuZWVkIHRvIG1ha2Ugc3VyZSBsZW5ndGggaXMgYmV0d2VlbiAxIGFuZCA0XG4gICAgY29uc3RydWN0b3IobGVuZ3RoKSB7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xuICAgICAgICB0aGlzLmhpdHMgPSAwO1xuICAgICAgICB0aGlzLnN1bmsgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBzZXRTdW5rKCkge1xuICAgICAgICB0aGlzLnN1bmsgPSB0cnVlO1xuICAgIH1cblxuICAgIGhpdCgpIHtcbiAgICAgICAgdGhpcy5oaXRzICsrXG4gICAgfVxuXG4gICAgaXNTdW5rKCkge1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IHRoaXMuaGl0cykgdGhpcy5zZXRTdW5rKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBpbml0aWFsaXNlU2hpcChsZW5ndGgpIHtcbiAgICBpZiAobGVuZ3RoIDwgMSB8fCBsZW5ndGggPiA1KSByZXR1cm4gXG4gICAgcmV0dXJuIG5ldyBTaGlwKGxlbmd0aClcbn1cblxuXG5leHBvcnQge2luaXRpYWxpc2VTaGlwLCBTaGlwfSIsImltcG9ydCB7IFNoaXAsIGluaXRpYWxpc2VTaGlwIH0gZnJvbSBcIi4vc2hpcFwiO1xuXG5jbGFzcyBTcGFjZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuaGFzU2hpcCA9IGZhbHNlO1xuICAgICAgICB0aGlzLndhc0d1ZXNzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5taXNzZWRIaXQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaGlwID0gbnVsbDtcbiAgICB9XG59XG5cbi8vIG5vdCBzdXJlIHdoZXJlIHRvIHB1dCB0aGlzIGJ1dCBuZWVkIHRvIGJlIGNhcmVmdWwgYWJvdXQgb3JkaW5hdGUgb3JkZXI7IGNvbCxyb3cgdnMgcm93LCBjb2xcbi8vIHVzZSBjb2wscm93IGZvciBtZXRob2QgYXJndW1lbnRzIGFuZCBwdXNoaW5nIGludG8gdmFyaWFibGVzIGxpa2UgZ3Vlc3NlZENvb3Jkc1xuLy8gdXNlIHJvdywgY29sIGZvciBnYW1lYm9hcmQgbG9naWNcbmNsYXNzIEdhbWVib2FyZCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUdyaWQoKSB7XG4gICAgICAgICAgICBsZXQgbmV3R3JpZCA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGk8MTA7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCByb3cgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgajwxMDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNxdWFyZSA9IG5ldyBTcGFjZSgpO1xuICAgICAgICAgICAgICAgICAgICByb3cucHVzaChzcXVhcmUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5ld0dyaWQucHVzaChyb3cpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3R3JpZFxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ3JpZCA9IGNyZWF0ZUdyaWQoKTtcbiAgICAgICAgdGhpcy5hbGxTaGlwQ29vcmRzID0gW107XG4gICAgICAgIHRoaXMuZ3Vlc3NlZENvb3JkcyA9IFtdO1xuICAgIH1cblxuICAgIGlzT3V0T2ZCb3VuZHMoY29sLCByb3cpIHtcbiAgICAgICAgaWYgKGNvbCA+IDkgfHwgcm93ID4gOSkgcmV0dXJuIHRydWU7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjaGVja0lmQWxyZWFkeVBsYWNlZChjb2wsIHJvdykge1xuICAgICAgICBpZiAodGhpcy5ncmlkW3Jvd11bY29sXS5oYXNTaGlwID09PSB0cnVlKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHBvcHVsYXRlU2hpcENvb3Jkc0FycmF5KGNvbCwgcm93KSB7XG4gICAgICAgIHRoaXMuYWxsU2hpcENvb3Jkcy5wdXNoKFtjb2wsIHJvd10pXG4gICAgfVxuXG4gICAgcGxhY2VTaGlwKGxlbmd0aCwgb3JpZW50YXRpb24sIFtzdGFydENvbCwgc3RhcnRSb3ddKSB7XG5cbiAgICAgICAgLy8gdGVzdCBpZiBzdGFydCBjb29yZCBpcyBvdXQgb2YgYm91bmRzXG4gICAgICAgIGlmICh0aGlzLmlzT3V0T2ZCb3VuZHMoc3RhcnRDb2wsIHN0YXJ0Um93KSkgcmV0dXJuICdvdXQgb2YgYm91bmRzJztcblxuICAgICAgICBsZXQgbmV3U2hpcCA9IGluaXRpYWxpc2VTaGlwKGxlbmd0aCk7XG4gICAgICAgIGlmICghbmV3U2hpcCkgcmV0dXJuO1xuXG4gICAgICAgIHN3aXRjaChvcmllbnRhdGlvbikge1xuICAgICAgICAgICAgLy8gaWYgb3JpZW50YXRpb24gaXMgaG9yaXpvbnRhbFxuICAgICAgICAgICAgLy8gc3R1ZmYgaGFwcGVucyBmcm9tIGxlZnQgdG8gcmlnaHRcbiAgICAgICAgICAgIGNhc2UgJ2hvcml6b250YWwnOlxuICAgICAgICAgICAgICAgIC8vbG9vcCBmb3IgbGVuZ3RoIGFuZCBjaGVjayBpZiBvdXQgb2YgYm91bmRzIG9yIGFscmVhZHkgb2NjdXBpZWQ7IGlmIHNvIGNhbmNlbCBleGVjdXRpb25cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaTwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPdXRPZkJvdW5kcyg5IC0gc3RhcnRSb3csIHN0YXJ0Q29sICsgaSkpIHJldHVybiAnb3V0IG9mIGJvdW5kcyc7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrSWZBbHJlYWR5UGxhY2VkKDkgLSBzdGFydFJvdywgc3RhcnRDb2wgKyBpKSkgcmV0dXJuICdwb3NpdGlvbiBhbHJlYWR5IG9jY3VwaWVkJztcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBlbHNlLCBsb29wIGFsb25nIHRoZSByb3cgKG9jY3VweSBjb2x1bW5zIG9mIHRoZSBzYW1lIHJvdylcbiAgICAgICAgICAgICAgICAvLyBhdCBlYWNoIGdyaWQgc3F1YXJlLCBvY2N1cHkgd2l0aCBzaGlwIElEXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGk8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkWzkgLSBzdGFydFJvd11bc3RhcnRDb2wgKyBpXS5oYXNTaGlwID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAvLyB0aGlzIG1heSBiZSBub3QgZ29vZFxuICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFs5IC0gc3RhcnRSb3ddW3N0YXJ0Q29sICsgaV0uc2hpcCA9IG5ld1NoaXA7XG5cbiAgICAgICAgICAgICAgICAgICAvLyBtYXkgYmUgYW4gZXJyb3IgaW4gdGhlIGNvbCBhbmQgcm93IGFyZ3VtZW50IG9yZGVyXG4gICAgICAgICAgICAgICAgICAgLy9ub3QgdW5kZXJzdGFuZC4uLlxuICAgICAgICAgICAgICAgICAgIC8vIGNoYW5nZSB0aGlzIGZyb20gc3BhY2VzLCB0byBjb29yZGluYXRlcywgY3VzIGkgZG9uJ3Qgd2FudCBhIGNvcHkgb2Ygb2JqZWN0c1xuICAgICAgICAgICAgICAgICAgIHRoaXMucG9wdWxhdGVTaGlwQ29vcmRzQXJyYXkoc3RhcnRDb2wgKyBpLCBzdGFydFJvdylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgICAgLy8gaWYgb3JpZW50YXRpb24gaXMgdmVydGljYWxcbiAgICAgICAgICAgIC8vIHNoaXAgaXMgY3JlYXRlZCBmcm9tIGJvdHRvbSB0byB0b3BcbiAgICAgICAgICAgIC8vIHJvd1swXSBpcyBib3R0b20sIHJvd1s5XSB0byB0b3AsIGR1ZSB0byB0aGUgYDkgLSBgXG4gICAgICAgICAgICBjYXNlICd2ZXJ0aWNhbCc6XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGk8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT3V0T2ZCb3VuZHMoOSAtIHN0YXJ0Um93ICsgaSwgc3RhcnRDb2wpKSByZXR1cm4gJ291dCBvZiBib3VuZHMnXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrSWZBbHJlYWR5UGxhY2VkKDkgLSBzdGFydFJvdyArIGksIHN0YXJ0Q29sKSkgcmV0dXJuICdwb3NpdGlvbiBhbHJlYWR5IG9jY3VwaWVkJ1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGFuZCB0aGVuIHB1dCBzdHVmZiBhbG9uZyB0aGUgY29sdW1uIChvY2N1cHkgcm93cyBvZiB0aGUgc2FtZSBjb2x1bW4pXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGk8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFs5IC0gc3RhcnRSb3cgKyBpXVtzdGFydENvbF0uaGFzU2hpcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFs5IC0gc3RhcnRSb3cgKyBpXVtzdGFydENvbF0uc2hpcCA9IG5ld1NoaXA7XG5cbiAgICAgICAgICAgICAgICAgICAvLyBtYXkgYmUgYW4gZXJyb3IgaW4gdGhlIGNvbCBhbmQgcm93IGFyZ3VtZW50IG9yZGVyXG4gICAgICAgICAgICAgICAgICAgLy8gY2hhbmdlIHRoaXMgZnJvbSBzcGFjZXMsIHRvIGNvb3JkaW5hdGVzLCBjdXMgaSBkb24ndCB3YW50IGEgY29weSBvZiBvYmplY3RzXG4gICAgICAgICAgICAgICAgICAgdGhpcy5wb3B1bGF0ZVNoaXBDb29yZHNBcnJheShzdGFydENvbCwgc3RhcnRSb3cgKyBpKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gd2hhdCBkbyBpIHBsYWNlIG9uIHRoZSBib2FyZD9cbiAgICAvLyA1IHBpZWNlcyBpIHRoaW5rXG4gICAgLy8gaG1tIGhvdyBkbyBpIGtlZXAgdHJ5aW5nIHRvIHBsYWNlIHRoZSBzaGlwcyBpZiB0aGV5IGFyZSBvdXQgb2YgYm91bmRzIG9yIGFscmVhZHkgcGFsY2VkP1xuICAgIC8vIHNob3VsZCBpIGp1c3QgcHV0IGVhY2ggaW4gYSB3aGlsZSBsb29wPyBvciB1c2UgcmVjdXJzaW9uP1xuXG4gICAgcGxhY2VBbGxTaGlwc09uQm9hcmQoKSB7XG4gICAgICAgIC8vIG5lZWQgdG8gcHV0IHNoaXBzIGhvcml6b250YWxseSBvciB2ZXJ0aWNhbGx5IHJhbmRvbWx5XG4gICAgICAgIC8vIHRoaXMgd2lsbCBvbmx5IGdlbmVyYXRlIG9uZSBvcmllbnRhdGlvbi4uLiBtYWtlIGl0IGEgc2VwYXJhdGUgZnVuY3Rpb25cbiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVSYW5kb21PcmllbnRhdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBbJ2hvcml6b250YWwnLCAndmVydGljYWwnXS5NYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkpXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZW5lcmF0ZVJhbmRvbUNvb3JkaW5hdGVzKCkge1xuICAgICAgICAgICAgY29uc3QgcmFuZG9tQ29sID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApXG4gICAgICAgICAgICBjb25zdCByYW5kb21Sb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMClcbiAgICAgICAgICAgIHJldHVybiBbcmFuZG9tQ29sLCByYW5kb21Sb3ddXG4gICAgICAgIH1cblxuXG4gICAgICAgIC8vaG93IGRvIGkgcHJldmVudCBmYWlsdXJlIHRvIHBsYWNlIGEgc2hpcD8gaXMgaXQgXG4gICAgICAgIC8vIHRoZXJlIGFyZSBzZXZlcmFsIG9wdGlvbnMuLi4gXG4gICAgICAgIC8vIHdoaWxlICgpIHt9XG4gICAgICAgIHRoaXMucGxhY2VTaGlwKDUsIGdlbmVyYXRlUmFuZG9tT3JpZW50YXRpb24oKSwgZ2VuZXJhdGVSYW5kb21Db29yZGluYXRlcygpKVxuXG4gICAgfVxuXG4gICAgZ2V0UG9zaXRpb24oY29sLCByb3cpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JpZFtyb3ddW2NvbF1cbiAgICB9XG5cbiAgICBjaGVja1NoaXBFeGlzdHMoY29sLCByb3cpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JpZFtyb3ddW2NvbF0uaGFzU2hpcFxuICAgIH1cblxuXG4gICAgZ2V0U2hpcChjb2wsIHJvdykge1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkW3Jvd11bY29sXS5zaGlwXG4gICAgfVxuXG4gICAgY2hlY2tNaXNzZWRIaXQoY29sLCByb3cpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JpZFtyb3ddW2NvbF0ubWlzc2VkSGl0XG4gICAgfVxuXG4gICAgY2hlY2tXYXNHdWVzc2VkKGNvbCwgcm93KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWRbcm93XVtjb2xdLndhc0d1ZXNzZWRcbiAgICB9XG5cbiAgICAvLyBjb21wYXJlIHN0cmluZ2lmaWVkIHNoaXAgY29vcmRzIHRvIHRoZSBndWVzc2VkIGNvb3JkcywgYW5kIHJldHVybiB0cnVlIGlmIGFsbCBzaGlwIGNvb3JkcyBhcmUgZ3Vlc3NlZC5cbiAgICBjaGVja0lzR2FtZU92ZXIoKSB7XG4gICAgICAgIGxldCBjb252ZXJ0ZWRBbGxTaGlwQ29vcmRzID0gdGhpcy5hbGxTaGlwQ29vcmRzLm1hcChjb29yZCA9PiBKU09OLnN0cmluZ2lmeShjb29yZCkpXG4gICAgICAgIGxldCBjb252ZXJ0ZWRHdWVzc2VkQ29vcmRzID0gdGhpcy5ndWVzc2VkQ29vcmRzLm1hcChjb29yZCA9PiBKU09OLnN0cmluZ2lmeShjb29yZCkpXG4gICAgICAgIC8vIGlmIChjb252ZXJ0ZWRBbGxTaGlwQ29vcmRzLmV2ZXJ5KHNoaXBDb29yZCA9PiBjb252ZXJ0ZWRHdWVzc2VkQ29vcmRzLmluY2x1ZGVzKHNoaXBDb29yZCkpKSB7XG4gICAgICAgIC8vICAgICB0aGlzLmlzR2FtZU92ZXIgPSB0cnVlO1xuICAgICAgICAvLyB9XG4gICAgICAgIHJldHVybiBjb252ZXJ0ZWRBbGxTaGlwQ29vcmRzLmV2ZXJ5KHNoaXBDb29yZCA9PiBjb252ZXJ0ZWRHdWVzc2VkQ29vcmRzLmluY2x1ZGVzKHNoaXBDb29yZCkpXG4gICAgfVxuXG4gICAgcmVjZWl2ZUF0dGFjayhjb2wsIHJvdykge1xuICAgICAgICAvLyBmaXJzdCwgY2hlY2sgaWYgcG9zaXRpb24gaXMgYWxyZWFkeSBndWVzc2VkXG4gICAgICAgIGlmICh0aGlzLmNoZWNrV2FzR3Vlc3NlZChjb2wsIHJvdykpIHJldHVybiAnYWxyZWFkeSBhdHRhY2tlZCc7XG4gICAgICAgIC8vIGlmIG5vdCBndWVzc2VkLCB0aGVuIG1hcmsgYXMgZ3Vlc3NlZFxuICAgICAgICB0aGlzLmdldFBvc2l0aW9uKGNvbCwgcm93KS53YXNHdWVzc2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5ndWVzc2VkQ29vcmRzLnB1c2goW2NvbCwgcm93XSlcblxuICAgICAgICAvLyBpZiBub3QsIGNoZWNrIGlmIHRoZXJlIGlzIGEgc2hpcCB0aGVyZVxuICAgICAgICBpZiAodGhpcy5jaGVja1NoaXBFeGlzdHMoY29sLCByb3cpKSB7XG4gICAgICAgICAgICAvLyBpZiB0aGVyZSBpcywgdGhlbiBpZGVudGlmeSB0aGUgc2hpcFxuICAgICAgICAgICAgLy8gdGhlbiBoaXQgdGhlIHNoaXBcbiAgICAgICAgICAgIHRoaXMuZ2V0U2hpcChjb2wsIHJvdykuaGl0KClcbiAgICAgICAgICAgIC8vIHRoZW4gY2hlY2sgaWYgc2hpcCBpcyBzdW5rXG4gICAgICAgICAgICB0aGlzLmdldFNoaXAoY29sLCByb3cpLmlzU3VuaygpO1xuXG4gICAgICAgICAgICAvLyB0aGVuIGNoZWNrIGlmIGFsbCBzaGlwcyBhcmUgaGl0LCBieSBjb21wYXJpbmcgYWxsU2hpcENvb3JkcyBhbmQgZ3Vlc3NlZENvb3JkcyBhcnJheXMgXG4gICAgICAgICAgICAvLyB0aGlzLmNoZWNrSXNHYW1lT3ZlcigpO1xuXG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgdGhlcmUgaXNuJ3QgYSBzaGlwLCB0aGVuIG1hcmsgdGhlIHBsYWNlIHdpdGggbWlzc2VkSGl0XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5nZXRQb3NpdGlvbihjb2wsIHJvdykubWlzc2VkSGl0ID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIFxufVxuZXhwb3J0IHtHYW1lYm9hcmR9IiwiZXhwb3J0IGNsYXNzIFBsYXllciB7XG4gICAgY29uc3RydWN0b3IoY29tcHV0ZXIpIHtcbiAgICB9XG5cbiAgICAvLyBobW0gaXMgdGhpcyBva2F5PyBkbyBpIG5lZWQgdG8gaW1wb3J0IGdhbWVib2FyZD8gc3VyZWx5IG5vdC4uLiB0aGF0IHdvdWxkIGJlIGF3ZnVsXG4gICAgLy8gaSBqdXN0IGNhbGxlZCB0aGUgcmVjZWl2ZUF0dGFjayBtZXRob2Qgb24gdGhlIGdhbWVib2FyZCBhcmd1bWVudC4uLiBpcyB0aGlzIGEgYmFkIHRoaW5nP1xuICAgIGF0dGFjayhnYW1lYm9hcmQsIFtjb2wsIHJvd10pIHtcbiAgICAgICAgZ2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29sLCByb3cpXG4gICAgfVxuXG4gICAgLy8gYWN0dWFsbHkgdGhpcyBjYW4ndCBiZSBpbiBoZXJlLi4uIGN1cyB0aGUgY29sIGFuZCByb3cgZG9uJ3QgY2hhbmdlLi4uIHRoZXkgZ290dGEgY2hhbmdlXG4gICAgdHJ5QXR0YWNrVW50aWxTdWNjZXNzKGdhbWVib2FyZCwgW2NvbCwgcm93XSkge1xuICAgICAgICBsZXQgaW5pdGlhbEd1ZXNzZXMgPSBKU09OLnN0cmluZ2lmeShnYW1lYm9hcmQuZ3Vlc3NlZENvb3JkcylcbiAgICAgICAgbGV0IGN1cnJlbnRHdWVzc2VzO1xuICAgICAgICB3aGlsZSAoaW5pdGlhbEd1ZXNzZXMgIT09IGN1cnJlbnRHdWVzc2VzKSB7XG4gICAgICAgICAgICB0aGlzLmF0dGFjayhnYW1lYm9hcmQsIFtjb2wsIHJvd10pXG4gICAgICAgICAgICBjdXJyZW50R3Vlc3NlcyA9IEpTT04uc3RyaW5naWZ5KGdhbWVib2FyZC5ndWVzc2VkQ29vcmRzKVxuICAgICAgICB9XG4gICAgfVxufVxuXG4vLyBhaGhoIGRvbid0IHRoaW5rIHRoaXMgd29ya3MsLCwgZ290dGEgdXNlIHN1cGVyP1xuZXhwb3J0IGNsYXNzIENvbXB1dGVyIGV4dGVuZHMgUGxheWVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKVxuICAgIH1cblxuICAgIHJhbmRvbUF0dGFjayhnYW1lYm9hcmQpIHtcbiAgICAgICAgLy8gdGFrZSByYW5kb20gbnVtYmVycyBmb3IgY29sdW1uIGFuZCByb3dcbiAgICAgICAgY29uc3QgcmFuZG9tQ29sID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApXG4gICAgICAgIGNvbnN0IHJhbmRvbVJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxuXG4gICAgICAgIC8vdGhlbiBjaGVjayBpZiBoYXMgYmVlbiBhdHRhY2tlZCxcbiAgICAgICAgaWYoZ2FtZWJvYXJkLmNoZWNrV2FzR3Vlc3NlZChyYW5kb21Db2wsIHJhbmRvbVJvdykpIHJldHVyblxuXG4gICAgICAgIC8vdGhlbiBjYWxsIGF0dGFja1xuICAgICAgICB0aGlzLmF0dGFjayhnYW1lYm9hcmQsIFtyYW5kb21Db2wsIHJhbmRvbVJvd10pXG4gICAgfVxufSIsImltcG9ydCB7IEdhbWVib2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IHsgUGxheWVyLCBDb21wdXRlciB9IGZyb20gXCIuL3BsYXllclwiO1xuXG5leHBvcnQgZnVuY3Rpb24gbWFrZUdhbWVDb250cm9sbGVyKCkge1xuICAgIC8vIGF0IHNvbWUgcG9pbnQsIHdpbGwgbmVlZCB0byBkZXZlbG9wIGZ1bmN0aW9uIHRvIHBsYWNlQWxsU2hpcHMsIHdoaWNoIFxuICAgIC8vIG5lZWRzIHRvIGdldCBhcm91bmQgdGhlIHByb2JsZW0gb2YgbG9vcGluZyBwbGFjZVNoaXAgdW50aWwgaXQgaXMgYWN0dWFsbHkgcGxhY2VkXG5cbiAgICAvLyBkbyBpIHVzZSBcbiAgICBsZXQgcGxheWVyR2FtZWJvYXJkID0gbmV3IEdhbWVib2FyZCgpO1xuICAgIGxldCBjb21wdXRlckdhbWVib2FyZCA9IG5ldyBHYW1lYm9hcmQoKTtcblxuICAgIGNvbnN0IHBsYXllciA9IG5ldyBQbGF5ZXIoKTtcbiAgICBjb25zdCBjb21wdXRlciA9IG5ldyBDb21wdXRlcigpO1xuXG4gICAgbGV0IGN1cnJlbnRQbGF5ZXIgPSBwbGF5ZXI7XG4gICAgbGV0IGVuZW15R2FtZWJvYXJkID0gY29tcHV0ZXJHYW1lYm9hcmRcblxuICAgIGxldCBpc0dhbWVPdmVyID0gZmFsc2U7XG5cbiAgICAvLyB3YWl0LCBpcyB0aGlzIG1vY2tpbmc/IGl0IG1heSBiZSB3b3J0aCBhIHJlYWQgYWdhaW4uLi5cblxuICAgIHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoNSwgJ3ZlcnRpY2FsJywgWzksNl0pO1xuICAgIHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoNCwgJ2hvcml6b250YWwnLCBbMCw4XSk7XG4gICAgcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcCgzLCAndmVydGljYWwnLCBbNSw2XSk7XG4gICAgcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcCgzLCAnaG9yaXpvbnRhbCcsIFsyLDNdKTtcbiAgICBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDIsICd2ZXJ0aWNhbCcsIFsxLDJdKTtcblxuICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcCg1LCAndmVydGljYWwnLCBbOSw2XSk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDQsICdob3Jpem9udGFsJywgWzAsOF0pO1xuICAgIC8vIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcCg0LCAndmVydGljYWwnLCBbNSw5XSk7XG4gICAgLy8gY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDQsICdob3Jpem9udGFsJywgWzUsOV0pO1xuICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcCgzLCAndmVydGljYWwnLCBbNSw2XSk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDMsICdob3Jpem9udGFsJywgWzIsM10pO1xuICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcCgyLCAndmVydGljYWwnLCBbMSwyXSk7XG5cbiAgICAvLyBpIHdpbGwgbmVlZCBET00gaW4gYW5vdGhlciBzZXBhcmF0ZSBmaWxlXG5cbiAgICAvLyB3aWxsIG5lZWQgdG8gdGVzdCBlYWNoIG9mIHRoZXNlLi4uXG4gICAgZnVuY3Rpb24gc3dhcFBsYXllckFuZEVuZW15KCkge1xuICAgICAgICBjdXJyZW50UGxheWVyID09PSBwbGF5ZXIgPyBjdXJyZW50UGxheWVyID0gY29tcHV0ZXIgOiBjdXJyZW50UGxheWVyID0gcGxheWVyO1xuICAgICAgICBlbmVteUdhbWVib2FyZCA9PT0gcGxheWVyR2FtZWJvYXJkID8gZW5lbXlHYW1lYm9hcmQgPSBjb21wdXRlckdhbWVib2FyZCA6IGVuZW15R2FtZWJvYXJkID0gcGxheWVyR2FtZWJvYXJkO1xuICAgIH1cblxuICAgIC8vIGlmIGdhbWUgaXMgb3Zlciwgc2V0IHRoZSBpc0dhbWVPdmVyIHZhcmlhYmxlIHRvIHRydWUgdG8gZW5kIHRoZSB3aGlsZSBsb29wLlxuICAgIGZ1bmN0aW9uIGNoZWNrSXNHYW1lT3ZlcihnYW1lYm9hcmQpIHtcbiAgICAgICAgaWYgKGdhbWVib2FyZC5jaGVja0lzR2FtZU92ZXIoKSkgaXNHYW1lT3ZlciA9IHRydWU7XG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIHZpc3VhbGlzZUdhbWVib2FyZChnYW1lYm9hcmQpIHtcbiAgICAgICAgLy8gaG93IGRvIGkgY29udmVydCB0aGUgZ2FtZWJvYXJkIHdpdGggdGhlIHNwYWNlcywgaW50byBhIGNvbnNvbGUgbG9nP1xuICAgICAgICAvLyBtYXliZSBhIGRvdWJsZSBtYXBcbiAgICAgICAgZ2FtZWJvYXJkLmdyaWQubWFwKHJvdyA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIHJvdy5tYXAoc3BhY2UgPT4ge1xuICAgICAgICAgICAgICAgIGlmKHNwYWNlLmhhc1NoaXAgPT09IGZhbHNlICYmIHNwYWNlLndhc0d1ZXNzZWQgPT09IGZhbHNlKSByZXR1cm4gJ18nXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoc3BhY2UuaGFzU2hpcCA9PT0gZmFsc2UgJiYgc3BhY2Uud2FzR3Vlc3NlZCA9PT0gdHJ1ZSkgcmV0dXJuICdtJ1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNwYWNlLmhhc1NoaXAgPT09IHRydWUgJiYgc3BhY2Uud2FzR3Vlc3NlZCA9PT0gZmFsc2UpIHJldHVybiAnbydcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChzcGFjZS5oYXNTaGlwID09PSB0cnVlICYmIHNwYWNlLndhc0d1ZXNzZWQgPT09IHRydWUpIHJldHVybiAneCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gaSBuZWVkIHRvIGNvbnNvbGUgbG9nIGVhY2ggcm93XG4gICAgICAgIFxuXG4gICAgfVxuXG4gICAgLy8gY2hlY2sgaWYgdGhlIGd1ZXNzZWRDb29yZHMgYXJyYXkgY2hhbmdlczsgaWYgc28sIHRoZSBhdHRhY2sgd2FzIHN1Y2Nlc3NmdWwuXG4gICAgLy8gdGhpcyBhYnNvbHV0ZWx5IG11c3QgZ2V0IHRlc3RlZC4uLlxuICAgIGZ1bmN0aW9uIHRyeUF0dGFja1VudGlsU3VjY2Vzcyhjb2wsIHJvdykge1xuICAgICAgICBsZXQgaW5pdGlhbEd1ZXNzZXMgPSBKU09OLnN0cmluZ2lmeShlbmVteUdhbWVib2FyZC5ndWVzc2VkQ29vcmRzKVxuICAgICAgICBsZXQgY3VycmVudEd1ZXNzZXM7XG5cbiAgICAgICAgc3dpdGNoIChjdXJyZW50UGxheWVyKSB7XG4gICAgICAgICAgICBjYXNlIHBsYXllcjpcbiAgICAgICAgICAgICAgICB3aGlsZSAoaW5pdGlhbEd1ZXNzZXMgPT09IGN1cnJlbnRHdWVzc2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXIuYXR0YWNrKGVuZW15R2FtZWJvYXJkLCBbY29sLCByb3ddKVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50R3Vlc3NlcyA9IEpTT04uc3RyaW5naWZ5KGVuZW15R2FtZWJvYXJkLmd1ZXNzZWRDb29yZHMpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIHBsYXllcjpcbiAgICAgICAgICAgICAgICB3aGlsZSAoaW5pdGlhbEd1ZXNzZXMgIT09IGN1cnJlbnRHdWVzc2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXIucmFuZG9tQXR0YWNrKGVuZW15R2FtZWJvYXJkKVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50R3Vlc3NlcyA9IEpTT04uc3RyaW5naWZ5KGVuZW15R2FtZWJvYXJkLmd1ZXNzZWRDb29yZHMpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIG5lZWQgd2hpbGUgbG9vcCwgd2hpbGUgZ2FtZSBpc24ndCBmaW5pc2hlZFxuICAgIC8vIG5lZWQgdG8gcGxheSBhIG1vdmUsIGFuZCBzb21laG93IGFsc28gZ2V0IGFyb3VuZCBwcm9ibGVtIG9mIHJldHVybmluZyBpZiBpbnZhbGlkIG1vdmVcbiAgICBmdW5jdGlvbiBwbGF5Um91bmQoKSB7XG5cbiAgICAgICAgc3dpdGNoIChjdXJyZW50UGxheWVyKSB7XG4gICAgICAgICAgICBjYXNlIHBsYXllcjpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncGxheWVyJylcbiAgICAgICAgICAgICAgICAvLyBsZXQgW2NvbCwgcm93XSA9IHByb21wdCgnY29vcmRzIHRvIGF0dGFjaywgaW4gXCJbeCx5XVwiJykuc3BsaXQoXCIsXCIpXG5cbiAgICAgICAgICAgICAgICAvLyBob3cgZG8gaSBtYWtlIGl0IHNvIHRoYXQgaWYgYW4gaW52YWxpZCBtb3ZlIGlzIG1hZGUsIHRyeSBhZ2Fpbj9cbiAgICAgICAgICAgICAgICAvLyBkbyBpIGltcGxlbWVudCB0aGF0IGhlcmU/XG4gICAgICAgICAgICAgICAgLy8gdGhlcmUgYXJlIHRocmVlIHBsYWNlcyBpIGNvdWxkIGltcGxlbWVudCBpdDsgcmVjZWl2ZUF0dGFjaygpLCBhdHRhY2soKSwgb3IgcGxheVJvdW5kKClcbiAgICAgICAgICAgICAgICAvLyBpIG5lZWQgdG8gbWFrZSB1c2Ugb2Ygc29tZXRoaW5nPyBlaXRoZXIgdGhlIHJldHVybiBzdGF0ZW1lbnQsIG9yIHRoZSBnYW1lYm9hcmQgY2hhbmdpbmc/IG9yIG1heWJlIHdhc0d1ZXNzZWQgY2hhbmdpbmc/XG5cbiAgICAgICAgICAgICAgICAvLyBjdXJyZW50UGxheWVyLmF0dGFjayhlbmVteUdhbWVib2FyZCwgW2NvbCwgcm93XSlcbiAgICAgICAgICAgICAgICAvLyBjdXJyZW50UGxheWVyLnRyeUF0dGFja1VudGlsU3VjY2VzcyhlbmVteUdhbWVib2FyZCwgW2NvbCwgcm93XSlcbiAgICAgICAgICAgICAgICAvLyBtYXliZSBwcmludCB0aGUgYm9hcmQuLi4/XG4gICAgICAgICAgICAgICAgdmlzdWFsaXNlR2FtZWJvYXJkKGVuZW15R2FtZWJvYXJkKTtcbiAgICAgICAgICAgICAgICBjaGVja0lzR2FtZU92ZXIoZW5lbXlHYW1lYm9hcmQpO1xuICAgICAgICAgICAgICAgIHN3YXBQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY2FzZSBjb21wdXRlcjpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY29tcHV0ZXInKVxuICAgICAgICAgICAgICAgIHZpc3VhbGlzZUdhbWVib2FyZCgpO1xuICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRQbGF5ZXIudHJ5QXR0YWNrVW50aWxTdWNjZXNzKGVuZW15R2FtZWJvYXJkKTtcbiAgICAgICAgICAgICAgICBjaGVja0lzR2FtZU92ZXIoZW5lbXlHYW1lYm9hcmQpO1xuICAgICAgICAgICAgICAgIHN3YXBQbGF5ZXIoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgZnVuY3Rpb24gcGxheUdhbWUoKSB7XG4gICAgICAgIHdoaWxlICghaXNHYW1lT3Zlcikge1xuICAgICAgICAgICAgcGxheVJvdW5kKClcbiAgICAgICAgfVxuXG4gICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHJ5QXR0YWNrVW50aWxTdWNjZXNzLFxuICAgICAgICAgICAgcGxheUdhbWUsXG4gICAgICAgIH1cbn0iLCJpbXBvcnQgeyBtYWtlR2FtZUNvbnRyb2xsZXIgfSBmcm9tIFwiLi9nYW1lQ29udHJvbGxlclwiO1xuXG5tYWtlR2FtZUNvbnRyb2xsZXIoKS5wbGF5R2FtZSgpIl0sIm5hbWVzIjpbIlNoaXAiLCJjb25zdHJ1Y3RvciIsImxlbmd0aCIsInRoaXMiLCJoaXRzIiwic3VuayIsInNldFN1bmsiLCJoaXQiLCJpc1N1bmsiLCJTcGFjZSIsImhhc1NoaXAiLCJ3YXNHdWVzc2VkIiwibWlzc2VkSGl0Iiwic2hpcCIsIkdhbWVib2FyZCIsImdyaWQiLCJuZXdHcmlkIiwiaSIsInJvdyIsImoiLCJzcXVhcmUiLCJwdXNoIiwiY3JlYXRlR3JpZCIsImFsbFNoaXBDb29yZHMiLCJndWVzc2VkQ29vcmRzIiwiaXNPdXRPZkJvdW5kcyIsImNvbCIsImNoZWNrSWZBbHJlYWR5UGxhY2VkIiwicG9wdWxhdGVTaGlwQ29vcmRzQXJyYXkiLCJwbGFjZVNoaXAiLCJvcmllbnRhdGlvbiIsInN0YXJ0Q29sIiwic3RhcnRSb3ciLCJuZXdTaGlwIiwiaW5pdGlhbGlzZVNoaXAiLCJwbGFjZUFsbFNoaXBzT25Cb2FyZCIsIk1hdGgiLCJyb3VuZCIsInJhbmRvbSIsImZsb29yIiwiZ2V0UG9zaXRpb24iLCJjaGVja1NoaXBFeGlzdHMiLCJnZXRTaGlwIiwiY2hlY2tNaXNzZWRIaXQiLCJjaGVja1dhc0d1ZXNzZWQiLCJjaGVja0lzR2FtZU92ZXIiLCJjb252ZXJ0ZWRBbGxTaGlwQ29vcmRzIiwibWFwIiwiY29vcmQiLCJKU09OIiwic3RyaW5naWZ5IiwiY29udmVydGVkR3Vlc3NlZENvb3JkcyIsImV2ZXJ5Iiwic2hpcENvb3JkIiwiaW5jbHVkZXMiLCJyZWNlaXZlQXR0YWNrIiwiUGxheWVyIiwiY29tcHV0ZXIiLCJhdHRhY2siLCJnYW1lYm9hcmQiLCJ0cnlBdHRhY2tVbnRpbFN1Y2Nlc3MiLCJjdXJyZW50R3Vlc3NlcyIsImluaXRpYWxHdWVzc2VzIiwiQ29tcHV0ZXIiLCJzdXBlciIsInJhbmRvbUF0dGFjayIsInJhbmRvbUNvbCIsInJhbmRvbVJvdyIsInBsYXllckdhbWVib2FyZCIsImNvbXB1dGVyR2FtZWJvYXJkIiwicGxheWVyIiwiY3VycmVudFBsYXllciIsImVuZW15R2FtZWJvYXJkIiwiaXNHYW1lT3ZlciIsInZpc3VhbGlzZUdhbWVib2FyZCIsImNvbnNvbGUiLCJsb2ciLCJzcGFjZSIsInBsYXlSb3VuZCIsInN3YXBQbGF5ZXIiLCJwbGF5R2FtZSIsIm1ha2VHYW1lQ29udHJvbGxlciJdLCJzb3VyY2VSb290IjoiIn0=