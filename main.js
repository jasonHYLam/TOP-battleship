(()=>{"use strict";class s{constructor(s){this.length=s,this.hits=0,this.sunk=!1}setSunk(){this.sunk=!0}hit(){this.hits++}isSunk(){this.length===this.hits&&this.setSunk()}}class t{constructor(){this.hasShip=!1,this.wasGuessed=!1,this.missedHit=!1,this.ship=null}}class i{constructor(){this.grid=function(){let s=[];for(let i=0;i<10;i++){let i=[];for(let s=0;s<10;s++){const s=new t;i.push(s)}s.push(i)}return s}(),this.allShipCoords=[],this.guessedCoords=[]}isOutOfBounds(s,t){return s>9||t>9}checkIfAlreadyPlaced(s,t){return!0===this.grid[t][s].hasShip}populateShipCoordsArray(s,t){this.allShipCoords.push([s,t])}placeShip(t,i,[e,o]){if(this.isOutOfBounds(e,o))return"out of bounds";let r=function(t){if(!(t<1||t>5))return new s(t)}(t);if(r)switch(i){case"horizontal":for(let s=0;s<t;s++){if(this.isOutOfBounds(o,e+s))return"out of bounds";if(this.checkIfAlreadyPlaced(o,e+s))return"position already occupied"}for(let s=0;s<t;s++)this.grid[o][e+s].hasShip=!0,this.grid[o][e+s].ship=r,this.populateShipCoordsArray(e+s,o);break;case"vertical":for(let s=0;s<t;s++){if(this.isOutOfBounds(o+s,e))return"out of bounds";if(this.checkIfAlreadyPlaced(o+s,e))return"position already occupied"}for(let s=0;s<t;s++)this.grid[o+s][e].hasShip=!0,this.grid[o+s][e].ship=r,this.populateShipCoordsArray(e,o+s)}}placeAllShipsOnBoard(){this.placeShip(5,["horizontal","vertical"].Math.round(Math.random()),[Math.floor(10*Math.random()),Math.floor(10*Math.random())])}getPosition(s,t){return this.grid[t][s]}checkShipExists(s,t){return this.grid[t][s].hasShip}getShip(s,t){return this.grid[t][s].ship}checkMissedHit(s,t){return this.grid[t][s].missedHit}checkWasGuessed(s,t){return this.grid[t][s].wasGuessed}checkIsGameOver(){let s=this.allShipCoords.map((s=>JSON.stringify(s))),t=this.guessedCoords.map((s=>JSON.stringify(s)));return s.every((s=>t.includes(s)))}receiveAttack(s,t){if(this.checkWasGuessed(s,t))return"already attacked";this.getPosition(s,t).wasGuessed=!0,this.guessedCoords.push([s,t]),this.checkShipExists(s,t)?(this.getShip(s,t).hit(),this.getShip(s,t).isSunk()):this.getPosition(s,t).missedHit=!0}}class e{constructor(s){}attack(s,[t,i]){s.receiveAttack(t,i)}}class o extends e{constructor(){super()}randomAttack(s){const t=Math.floor(10*Math.random()),i=Math.floor(10*Math.random());s.checkWasGuessed(t,i)||this.attack(s,[t,i])}}(function(){let s=new i,t=new i;const r=new e,h=new o;let a=r,c=t,n=!1;function l(){a=a===r?h:r,c=c===s?t:s}function u(s){s.checkIsGameOver()&&(n=!0)}function d(s){s.grid.map((s=>{console.log(s.map((s=>!1===s.hasShip&&!1===s.wasGuessed?"_":!1===s.hasShip&&!0===s.wasGuessed?"m":!0===s.hasShip&&!1===s.wasGuessed?"o":!0===s.hasShip&&!0===s.wasGuessed?"x":void 0)))}))}function p(){let s=JSON.stringify(c.guessedCoords),t=s;switch(a){case r:let i=!1;for(;!i;){console.log(s===t),console.log("work?");let[e,o]=prompt('coords to attack, in "x,y"').split(",");a.attack(c,[e,o]),t=JSON.stringify(c.guessedCoords),console.log(s),console.log(t),s!==t&&(i=!0)}break;case h:for(;s!==t;)a.randomAttack(c),t=JSON.stringify(c.guessedCoords)}}function f(){switch(a){case r:console.log("player"),d(c),p(),u(c),l(),console.log(a),console.log(c);break;case h:console.log("computer"),d(c),p(),u(c),l()}}return s.placeShip(5,"vertical",[9,6]),s.placeShip(4,"horizontal",[0,8]),s.placeShip(3,"vertical",[5,6]),s.placeShip(3,"horizontal",[2,3]),s.placeShip(2,"vertical",[1,2]),t.placeShip(5,"vertical",[9,3]),t.placeShip(4,"horizontal",[0,8]),t.placeShip(3,"vertical",[5,6]),t.placeShip(3,"horizontal",[2,3]),t.placeShip(2,"vertical",[1,2]),{tryAttackUntilSuccess:p,playGame:function(){for(;!n;)f()}}})().playGame()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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OUNxQyxFQUFrQnJDLFVBQVUsRUFBRyxhQUFjLENBQUMsRUFBRSxJQUNoRHFDLEVBQWtCckMsVUFBVSxFQUFHLFdBQVksQ0FBQyxFQUFFLElBd0duQyxDQUNIK0Msd0JBQ0FPLFNBUlIsV0FDSSxNQUFRYixHQUNKWSxHQUdSLEVBS0osRUN2SUFFLEdBQXFCRCxVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvc2hpcC5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL2dhbWVDb250cm9sbGVyLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlxuY2xhc3MgU2hpcCB7XG4gICAgLy8gaSBuZWVkIHRvIG1ha2Ugc3VyZSBsZW5ndGggaXMgYmV0d2VlbiAxIGFuZCA0XG4gICAgY29uc3RydWN0b3IobGVuZ3RoKSB7XG4gICAgICAgIHRoaXMubGVuZ3RoID0gbGVuZ3RoO1xuICAgICAgICB0aGlzLmhpdHMgPSAwO1xuICAgICAgICB0aGlzLnN1bmsgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBzZXRTdW5rKCkge1xuICAgICAgICB0aGlzLnN1bmsgPSB0cnVlO1xuICAgIH1cblxuICAgIGhpdCgpIHtcbiAgICAgICAgdGhpcy5oaXRzICsrXG4gICAgfVxuXG4gICAgaXNTdW5rKCkge1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IHRoaXMuaGl0cykgdGhpcy5zZXRTdW5rKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBpbml0aWFsaXNlU2hpcChsZW5ndGgpIHtcbiAgICBpZiAobGVuZ3RoIDwgMSB8fCBsZW5ndGggPiA1KSByZXR1cm4gXG4gICAgcmV0dXJuIG5ldyBTaGlwKGxlbmd0aClcbn1cblxuXG5leHBvcnQge2luaXRpYWxpc2VTaGlwLCBTaGlwfSIsImltcG9ydCB7IFNoaXAsIGluaXRpYWxpc2VTaGlwIH0gZnJvbSBcIi4vc2hpcFwiO1xuXG5jbGFzcyBTcGFjZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuaGFzU2hpcCA9IGZhbHNlO1xuICAgICAgICB0aGlzLndhc0d1ZXNzZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5taXNzZWRIaXQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zaGlwID0gbnVsbDtcbiAgICB9XG59XG5cbi8vIG5vdCBzdXJlIHdoZXJlIHRvIHB1dCB0aGlzIGJ1dCBuZWVkIHRvIGJlIGNhcmVmdWwgYWJvdXQgb3JkaW5hdGUgb3JkZXI7IGNvbCxyb3cgdnMgcm93LCBjb2xcbi8vIHVzZSBjb2wscm93IGZvciBtZXRob2QgYXJndW1lbnRzIGFuZCBwdXNoaW5nIGludG8gdmFyaWFibGVzIGxpa2UgZ3Vlc3NlZENvb3Jkc1xuLy8gdXNlIHJvdywgY29sIGZvciBnYW1lYm9hcmQgbG9naWNcbmNsYXNzIEdhbWVib2FyZCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUdyaWQoKSB7XG4gICAgICAgICAgICBsZXQgbmV3R3JpZCA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGk8MTA7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCByb3cgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgajwxMDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNxdWFyZSA9IG5ldyBTcGFjZSgpO1xuICAgICAgICAgICAgICAgICAgICByb3cucHVzaChzcXVhcmUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5ld0dyaWQucHVzaChyb3cpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3R3JpZFxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZ3JpZCA9IGNyZWF0ZUdyaWQoKTtcbiAgICAgICAgdGhpcy5hbGxTaGlwQ29vcmRzID0gW107XG4gICAgICAgIHRoaXMuZ3Vlc3NlZENvb3JkcyA9IFtdO1xuICAgIH1cblxuICAgIGlzT3V0T2ZCb3VuZHMoY29sLCByb3cpIHtcbiAgICAgICAgaWYgKGNvbCA+IDkgfHwgcm93ID4gOSkgcmV0dXJuIHRydWU7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjaGVja0lmQWxyZWFkeVBsYWNlZChjb2wsIHJvdykge1xuICAgICAgICBpZiAodGhpcy5ncmlkW3Jvd11bY29sXS5oYXNTaGlwID09PSB0cnVlKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHBvcHVsYXRlU2hpcENvb3Jkc0FycmF5KGNvbCwgcm93KSB7XG4gICAgICAgIHRoaXMuYWxsU2hpcENvb3Jkcy5wdXNoKFtjb2wsIHJvd10pXG4gICAgfVxuXG4gICAgcGxhY2VTaGlwKGxlbmd0aCwgb3JpZW50YXRpb24sIFtzdGFydENvbCwgc3RhcnRSb3ddKSB7XG5cbiAgICAgICAgLy8gdGVzdCBpZiBzdGFydCBjb29yZCBpcyBvdXQgb2YgYm91bmRzXG4gICAgICAgIGlmICh0aGlzLmlzT3V0T2ZCb3VuZHMoc3RhcnRDb2wsIHN0YXJ0Um93KSkgcmV0dXJuICdvdXQgb2YgYm91bmRzJztcblxuICAgICAgICBsZXQgbmV3U2hpcCA9IGluaXRpYWxpc2VTaGlwKGxlbmd0aCk7XG4gICAgICAgIGlmICghbmV3U2hpcCkgcmV0dXJuO1xuXG4gICAgICAgIHN3aXRjaChvcmllbnRhdGlvbikge1xuICAgICAgICAgICAgLy8gaWYgb3JpZW50YXRpb24gaXMgaG9yaXpvbnRhbFxuICAgICAgICAgICAgLy8gc3R1ZmYgaGFwcGVucyBmcm9tIGxlZnQgdG8gcmlnaHRcbiAgICAgICAgICAgIGNhc2UgJ2hvcml6b250YWwnOlxuICAgICAgICAgICAgICAgIC8vbG9vcCBmb3IgbGVuZ3RoIGFuZCBjaGVjayBpZiBvdXQgb2YgYm91bmRzIG9yIGFscmVhZHkgb2NjdXBpZWQ7IGlmIHNvIGNhbmNlbCBleGVjdXRpb25cbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaTwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPdXRPZkJvdW5kcyhzdGFydFJvdywgc3RhcnRDb2wgKyBpKSkgcmV0dXJuICdvdXQgb2YgYm91bmRzJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tJZkFscmVhZHlQbGFjZWQoc3RhcnRSb3csIHN0YXJ0Q29sICsgaSkpIHJldHVybiAncG9zaXRpb24gYWxyZWFkeSBvY2N1cGllZCc7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gZWxzZSwgbG9vcCBhbG9uZyB0aGUgcm93IChvY2N1cHkgY29sdW1ucyBvZiB0aGUgc2FtZSByb3cpXG4gICAgICAgICAgICAgICAgLy8gYXQgZWFjaCBncmlkIHNxdWFyZSwgb2NjdXB5IHdpdGggc2hpcCBJRFxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFtzdGFydFJvd11bc3RhcnRDb2wgKyBpXS5oYXNTaGlwID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAvLyB0aGlzIG1heSBiZSBub3QgZ29vZFxuICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFtzdGFydFJvd11bc3RhcnRDb2wgKyBpXS5zaGlwID0gbmV3U2hpcDtcblxuICAgICAgICAgICAgICAgICAgIC8vIG1heSBiZSBhbiBlcnJvciBpbiB0aGUgY29sIGFuZCByb3cgYXJndW1lbnQgb3JkZXJcbiAgICAgICAgICAgICAgICAgICAvL25vdCB1bmRlcnN0YW5kLi4uXG4gICAgICAgICAgICAgICAgICAgLy8gY2hhbmdlIHRoaXMgZnJvbSBzcGFjZXMsIHRvIGNvb3JkaW5hdGVzLCBjdXMgaSBkb24ndCB3YW50IGEgY29weSBvZiBvYmplY3RzXG4gICAgICAgICAgICAgICAgICAgdGhpcy5wb3B1bGF0ZVNoaXBDb29yZHNBcnJheShzdGFydENvbCArIGksIHN0YXJ0Um93KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVha1xuXG4gICAgICAgICAgICAvLyBpZiBvcmllbnRhdGlvbiBpcyB2ZXJ0aWNhbFxuICAgICAgICAgICAgLy8gc2hpcCBpcyBjcmVhdGVkIGZyb20gYm90dG9tIHRvIHRvcFxuICAgICAgICAgICAgLy8gcm93WzBdIGlzIGJvdHRvbSwgcm93WzldIHRvIHRvcCwgZHVlIHRvIHRoZSBgOSAtIGBcbiAgICAgICAgICAgIGNhc2UgJ3ZlcnRpY2FsJzpcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaTwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNPdXRPZkJvdW5kcyhzdGFydFJvdyArIGksIHN0YXJ0Q29sKSkgcmV0dXJuICdvdXQgb2YgYm91bmRzJ1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jaGVja0lmQWxyZWFkeVBsYWNlZChzdGFydFJvdyArIGksIHN0YXJ0Q29sKSkgcmV0dXJuICdwb3NpdGlvbiBhbHJlYWR5IG9jY3VwaWVkJ1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGFuZCB0aGVuIHB1dCBzdHVmZiBhbG9uZyB0aGUgY29sdW1uIChvY2N1cHkgcm93cyBvZiB0aGUgc2FtZSBjb2x1bW4pXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGk8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFtzdGFydFJvdyArIGldW3N0YXJ0Q29sXS5oYXNTaGlwID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ncmlkW3N0YXJ0Um93ICsgaV1bc3RhcnRDb2xdLnNoaXAgPSBuZXdTaGlwO1xuXG4gICAgICAgICAgICAgICAgICAgLy8gbWF5IGJlIGFuIGVycm9yIGluIHRoZSBjb2wgYW5kIHJvdyBhcmd1bWVudCBvcmRlclxuICAgICAgICAgICAgICAgICAgIC8vIGNoYW5nZSB0aGlzIGZyb20gc3BhY2VzLCB0byBjb29yZGluYXRlcywgY3VzIGkgZG9uJ3Qgd2FudCBhIGNvcHkgb2Ygb2JqZWN0c1xuICAgICAgICAgICAgICAgICAgIHRoaXMucG9wdWxhdGVTaGlwQ29vcmRzQXJyYXkoc3RhcnRDb2wsIHN0YXJ0Um93ICsgaSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIHdoYXQgZG8gaSBwbGFjZSBvbiB0aGUgYm9hcmQ/XG4gICAgLy8gNSBwaWVjZXMgaSB0aGlua1xuICAgIC8vIGhtbSBob3cgZG8gaSBrZWVwIHRyeWluZyB0byBwbGFjZSB0aGUgc2hpcHMgaWYgdGhleSBhcmUgb3V0IG9mIGJvdW5kcyBvciBhbHJlYWR5IHBhbGNlZD9cbiAgICAvLyBzaG91bGQgaSBqdXN0IHB1dCBlYWNoIGluIGEgd2hpbGUgbG9vcD8gb3IgdXNlIHJlY3Vyc2lvbj9cblxuICAgIHBsYWNlQWxsU2hpcHNPbkJvYXJkKCkge1xuICAgICAgICAvLyBuZWVkIHRvIHB1dCBzaGlwcyBob3Jpem9udGFsbHkgb3IgdmVydGljYWxseSByYW5kb21seVxuICAgICAgICAvLyB0aGlzIHdpbGwgb25seSBnZW5lcmF0ZSBvbmUgb3JpZW50YXRpb24uLi4gbWFrZSBpdCBhIHNlcGFyYXRlIGZ1bmN0aW9uXG4gICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlUmFuZG9tT3JpZW50YXRpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gWydob3Jpem9udGFsJywgJ3ZlcnRpY2FsJ10uTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVSYW5kb21Db29yZGluYXRlcygpIHtcbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbUNvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxuICAgICAgICAgICAgY29uc3QgcmFuZG9tUm93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApXG4gICAgICAgICAgICByZXR1cm4gW3JhbmRvbUNvbCwgcmFuZG9tUm93XVxuICAgICAgICB9XG5cblxuICAgICAgICAvL2hvdyBkbyBpIHByZXZlbnQgZmFpbHVyZSB0byBwbGFjZSBhIHNoaXA/IGlzIGl0IFxuICAgICAgICAvLyB0aGVyZSBhcmUgc2V2ZXJhbCBvcHRpb25zLi4uIFxuICAgICAgICAvLyB3aGlsZSAoKSB7fVxuICAgICAgICB0aGlzLnBsYWNlU2hpcCg1LCBnZW5lcmF0ZVJhbmRvbU9yaWVudGF0aW9uKCksIGdlbmVyYXRlUmFuZG9tQ29vcmRpbmF0ZXMoKSlcblxuICAgIH1cblxuICAgIGdldFBvc2l0aW9uKGNvbCwgcm93KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWRbcm93XVtjb2xdXG4gICAgfVxuXG4gICAgY2hlY2tTaGlwRXhpc3RzKGNvbCwgcm93KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWRbcm93XVtjb2xdLmhhc1NoaXBcbiAgICB9XG5cblxuICAgIGdldFNoaXAoY29sLCByb3cpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JpZFtyb3ddW2NvbF0uc2hpcFxuICAgIH1cblxuICAgIGNoZWNrTWlzc2VkSGl0KGNvbCwgcm93KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWRbcm93XVtjb2xdLm1pc3NlZEhpdFxuICAgIH1cblxuICAgIGNoZWNrV2FzR3Vlc3NlZChjb2wsIHJvdykge1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkW3Jvd11bY29sXS53YXNHdWVzc2VkXG4gICAgfVxuXG4gICAgLy8gY29tcGFyZSBzdHJpbmdpZmllZCBzaGlwIGNvb3JkcyB0byB0aGUgZ3Vlc3NlZCBjb29yZHMsIGFuZCByZXR1cm4gdHJ1ZSBpZiBhbGwgc2hpcCBjb29yZHMgYXJlIGd1ZXNzZWQuXG4gICAgY2hlY2tJc0dhbWVPdmVyKCkge1xuICAgICAgICBsZXQgY29udmVydGVkQWxsU2hpcENvb3JkcyA9IHRoaXMuYWxsU2hpcENvb3Jkcy5tYXAoY29vcmQgPT4gSlNPTi5zdHJpbmdpZnkoY29vcmQpKVxuICAgICAgICBsZXQgY29udmVydGVkR3Vlc3NlZENvb3JkcyA9IHRoaXMuZ3Vlc3NlZENvb3Jkcy5tYXAoY29vcmQgPT4gSlNPTi5zdHJpbmdpZnkoY29vcmQpKVxuICAgICAgICAvLyBpZiAoY29udmVydGVkQWxsU2hpcENvb3Jkcy5ldmVyeShzaGlwQ29vcmQgPT4gY29udmVydGVkR3Vlc3NlZENvb3Jkcy5pbmNsdWRlcyhzaGlwQ29vcmQpKSkge1xuICAgICAgICAvLyAgICAgdGhpcy5pc0dhbWVPdmVyID0gdHJ1ZTtcbiAgICAgICAgLy8gfVxuICAgICAgICByZXR1cm4gY29udmVydGVkQWxsU2hpcENvb3Jkcy5ldmVyeShzaGlwQ29vcmQgPT4gY29udmVydGVkR3Vlc3NlZENvb3Jkcy5pbmNsdWRlcyhzaGlwQ29vcmQpKVxuICAgIH1cblxuICAgIHJlY2VpdmVBdHRhY2soY29sLCByb3cpIHtcbiAgICAgICAgLy8gZmlyc3QsIGNoZWNrIGlmIHBvc2l0aW9uIGlzIGFscmVhZHkgZ3Vlc3NlZFxuICAgICAgICBpZiAodGhpcy5jaGVja1dhc0d1ZXNzZWQoY29sLCByb3cpKSByZXR1cm4gJ2FscmVhZHkgYXR0YWNrZWQnO1xuICAgICAgICAvLyBpZiBub3QgZ3Vlc3NlZCwgdGhlbiBtYXJrIGFzIGd1ZXNzZWRcbiAgICAgICAgdGhpcy5nZXRQb3NpdGlvbihjb2wsIHJvdykud2FzR3Vlc3NlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuZ3Vlc3NlZENvb3Jkcy5wdXNoKFtjb2wsIHJvd10pXG5cbiAgICAgICAgLy8gaWYgbm90LCBjaGVjayBpZiB0aGVyZSBpcyBhIHNoaXAgdGhlcmVcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tTaGlwRXhpc3RzKGNvbCwgcm93KSkge1xuICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMsIHRoZW4gaWRlbnRpZnkgdGhlIHNoaXBcbiAgICAgICAgICAgIC8vIHRoZW4gaGl0IHRoZSBzaGlwXG4gICAgICAgICAgICB0aGlzLmdldFNoaXAoY29sLCByb3cpLmhpdCgpXG4gICAgICAgICAgICAvLyB0aGVuIGNoZWNrIGlmIHNoaXAgaXMgc3Vua1xuICAgICAgICAgICAgdGhpcy5nZXRTaGlwKGNvbCwgcm93KS5pc1N1bmsoKTtcblxuICAgICAgICAgICAgLy8gdGhlbiBjaGVjayBpZiBhbGwgc2hpcHMgYXJlIGhpdCwgYnkgY29tcGFyaW5nIGFsbFNoaXBDb29yZHMgYW5kIGd1ZXNzZWRDb29yZHMgYXJyYXlzIFxuICAgICAgICAgICAgLy8gdGhpcy5jaGVja0lzR2FtZU92ZXIoKTtcblxuICAgICAgICB9XG4gICAgICAgIC8vIGlmIHRoZXJlIGlzbid0IGEgc2hpcCwgdGhlbiBtYXJrIHRoZSBwbGFjZSB3aXRoIG1pc3NlZEhpdFxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZ2V0UG9zaXRpb24oY29sLCByb3cpLm1pc3NlZEhpdCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBcbn1cbmV4cG9ydCB7R2FtZWJvYXJkfSIsImV4cG9ydCBjbGFzcyBQbGF5ZXIge1xuICAgIGNvbnN0cnVjdG9yKGNvbXB1dGVyKSB7XG4gICAgfVxuXG4gICAgLy8gaG1tIGlzIHRoaXMgb2theT8gZG8gaSBuZWVkIHRvIGltcG9ydCBnYW1lYm9hcmQ/IHN1cmVseSBub3QuLi4gdGhhdCB3b3VsZCBiZSBhd2Z1bFxuICAgIC8vIGkganVzdCBjYWxsZWQgdGhlIHJlY2VpdmVBdHRhY2sgbWV0aG9kIG9uIHRoZSBnYW1lYm9hcmQgYXJndW1lbnQuLi4gaXMgdGhpcyBhIGJhZCB0aGluZz9cbiAgICBhdHRhY2soZ2FtZWJvYXJkLCBbY29sLCByb3ddKSB7XG4gICAgICAgIGdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvbCwgcm93KVxuICAgIH1cblxuICAgIC8vIGFjdHVhbGx5IHRoaXMgY2FuJ3QgYmUgaW4gaGVyZS4uLiBjdXMgdGhlIGNvbCBhbmQgcm93IGRvbid0IGNoYW5nZS4uLiB0aGV5IGdvdHRhIGNoYW5nZVxuICAgIC8vIHRyeUF0dGFja1VudGlsU3VjY2VzcyhnYW1lYm9hcmQsIFtjb2wsIHJvd10pIHtcbiAgICAvLyAgICAgbGV0IGluaXRpYWxHdWVzc2VzID0gSlNPTi5zdHJpbmdpZnkoZ2FtZWJvYXJkLmd1ZXNzZWRDb29yZHMpXG4gICAgLy8gICAgIGxldCBjdXJyZW50R3Vlc3NlcztcbiAgICAvLyAgICAgd2hpbGUgKGluaXRpYWxHdWVzc2VzICE9PSBjdXJyZW50R3Vlc3Nlcykge1xuICAgIC8vICAgICAgICAgdGhpcy5hdHRhY2soZ2FtZWJvYXJkLCBbY29sLCByb3ddKVxuICAgIC8vICAgICAgICAgY3VycmVudEd1ZXNzZXMgPSBKU09OLnN0cmluZ2lmeShnYW1lYm9hcmQuZ3Vlc3NlZENvb3JkcylcbiAgICAvLyAgICAgfVxuICAgIC8vIH1cbn1cblxuLy8gYWhoaCBkb24ndCB0aGluayB0aGlzIHdvcmtzLCwsIGdvdHRhIHVzZSBzdXBlcj9cbmV4cG9ydCBjbGFzcyBDb21wdXRlciBleHRlbmRzIFBsYXllciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKClcbiAgICB9XG5cbiAgICByYW5kb21BdHRhY2soZ2FtZWJvYXJkKSB7XG4gICAgICAgIC8vIHRha2UgcmFuZG9tIG51bWJlcnMgZm9yIGNvbHVtbiBhbmQgcm93XG4gICAgICAgIGNvbnN0IHJhbmRvbUNvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxuICAgICAgICBjb25zdCByYW5kb21Sb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMClcblxuICAgICAgICAvL3RoZW4gY2hlY2sgaWYgaGFzIGJlZW4gYXR0YWNrZWQsXG4gICAgICAgIGlmKGdhbWVib2FyZC5jaGVja1dhc0d1ZXNzZWQocmFuZG9tQ29sLCByYW5kb21Sb3cpKSByZXR1cm5cblxuICAgICAgICAvL3RoZW4gY2FsbCBhdHRhY2tcbiAgICAgICAgdGhpcy5hdHRhY2soZ2FtZWJvYXJkLCBbcmFuZG9tQ29sLCByYW5kb21Sb3ddKVxuICAgIH1cbn0iLCJpbXBvcnQgeyBHYW1lYm9hcmQgfSBmcm9tIFwiLi9nYW1lYm9hcmRcIjtcbmltcG9ydCB7IFBsYXllciwgQ29tcHV0ZXIgfSBmcm9tIFwiLi9wbGF5ZXJcIjtcblxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VHYW1lQ29udHJvbGxlcigpIHtcbiAgICAvLyBhdCBzb21lIHBvaW50LCB3aWxsIG5lZWQgdG8gZGV2ZWxvcCBmdW5jdGlvbiB0byBwbGFjZUFsbFNoaXBzLCB3aGljaCBcbiAgICAvLyBuZWVkcyB0byBnZXQgYXJvdW5kIHRoZSBwcm9ibGVtIG9mIGxvb3BpbmcgcGxhY2VTaGlwIHVudGlsIGl0IGlzIGFjdHVhbGx5IHBsYWNlZFxuXG4gICAgbGV0IHBsYXllckdhbWVib2FyZCA9IG5ldyBHYW1lYm9hcmQoKTtcbiAgICBsZXQgY29tcHV0ZXJHYW1lYm9hcmQgPSBuZXcgR2FtZWJvYXJkKCk7XG5cbiAgICBjb25zdCBwbGF5ZXIgPSBuZXcgUGxheWVyKCk7XG4gICAgY29uc3QgY29tcHV0ZXIgPSBuZXcgQ29tcHV0ZXIoKTtcblxuICAgIGxldCBjdXJyZW50UGxheWVyID0gcGxheWVyO1xuICAgIGxldCBlbmVteUdhbWVib2FyZCA9IGNvbXB1dGVyR2FtZWJvYXJkXG5cbiAgICBsZXQgaXNHYW1lT3ZlciA9IGZhbHNlO1xuXG4gICAgLy8gd2FpdCwgaXMgdGhpcyBtb2NraW5nPyBpdCBtYXkgYmUgd29ydGggYSByZWFkIGFnYWluLi4uXG4gICAgcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcCg1LCAndmVydGljYWwnLCBbOSw2XSk7XG4gICAgcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcCg0LCAnaG9yaXpvbnRhbCcsIFswLDhdKTtcbiAgICBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDMsICd2ZXJ0aWNhbCcsIFs1LDZdKTtcbiAgICBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDMsICdob3Jpem9udGFsJywgWzIsM10pO1xuICAgIHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoMiwgJ3ZlcnRpY2FsJywgWzEsMl0pO1xuXG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDUsICd2ZXJ0aWNhbCcsIFs5LDNdKTtcbiAgICBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoNCwgJ2hvcml6b250YWwnLCBbMCw4XSk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDMsICd2ZXJ0aWNhbCcsIFs1LDZdKTtcbiAgICBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoMywgJ2hvcml6b250YWwnLCBbMiwzXSk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDIsICd2ZXJ0aWNhbCcsIFsxLDJdKTtcblxuICAgIC8vIHdpbGwgbmVlZCB0byB0ZXN0IGVhY2ggb2YgdGhlc2UuLi5cbiAgICBmdW5jdGlvbiBzd2FwUGxheWVyQW5kRW5lbXkoKSB7XG4gICAgICAgIGN1cnJlbnRQbGF5ZXIgPT09IHBsYXllciA/IGN1cnJlbnRQbGF5ZXIgPSBjb21wdXRlciA6IGN1cnJlbnRQbGF5ZXIgPSBwbGF5ZXI7XG4gICAgICAgIGVuZW15R2FtZWJvYXJkID09PSBwbGF5ZXJHYW1lYm9hcmQgPyBlbmVteUdhbWVib2FyZCA9IGNvbXB1dGVyR2FtZWJvYXJkIDogZW5lbXlHYW1lYm9hcmQgPSBwbGF5ZXJHYW1lYm9hcmQ7XG4gICAgfVxuXG4gICAgLy8gaWYgZ2FtZSBpcyBvdmVyLCBzZXQgdGhlIGlzR2FtZU92ZXIgdmFyaWFibGUgdG8gdHJ1ZSB0byBlbmQgdGhlIHdoaWxlIGxvb3AuXG4gICAgZnVuY3Rpb24gY2hlY2tJc0dhbWVPdmVyKGdhbWVib2FyZCkge1xuICAgICAgICBpZiAoZ2FtZWJvYXJkLmNoZWNrSXNHYW1lT3ZlcigpKSBpc0dhbWVPdmVyID0gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgZnVuY3Rpb24gdmlzdWFsaXNlR2FtZWJvYXJkKGdhbWVib2FyZCkge1xuICAgICAgICAvLyBob3cgZG8gaSBjb252ZXJ0IHRoZSBnYW1lYm9hcmQgd2l0aCB0aGUgc3BhY2VzLCBpbnRvIGEgY29uc29sZSBsb2c/XG4gICAgICAgIC8vIG1heWJlIGEgZG91YmxlIG1hcFxuICAgICAgICBnYW1lYm9hcmQuZ3JpZC5tYXAocm93ID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgcm93Lm1hcChzcGFjZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYoc3BhY2UuaGFzU2hpcCA9PT0gZmFsc2UgJiYgc3BhY2Uud2FzR3Vlc3NlZCA9PT0gZmFsc2UpIHJldHVybiAnXydcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChzcGFjZS5oYXNTaGlwID09PSBmYWxzZSAmJiBzcGFjZS53YXNHdWVzc2VkID09PSB0cnVlKSByZXR1cm4gJ20nXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoc3BhY2UuaGFzU2hpcCA9PT0gdHJ1ZSAmJiBzcGFjZS53YXNHdWVzc2VkID09PSBmYWxzZSkgcmV0dXJuICdvJ1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNwYWNlLmhhc1NoaXAgPT09IHRydWUgJiYgc3BhY2Uud2FzR3Vlc3NlZCA9PT0gdHJ1ZSkgcmV0dXJuICd4J1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICAvLyBjaGVjayBpZiB0aGUgZ3Vlc3NlZENvb3JkcyBhcnJheSBjaGFuZ2VzOyBpZiBzbywgdGhlIGF0dGFjayB3YXMgc3VjY2Vzc2Z1bC5cbiAgICAvLyB0aGlzIGFic29sdXRlbHkgbXVzdCBnZXQgdGVzdGVkLi4uXG4gICAgZnVuY3Rpb24gdHJ5QXR0YWNrVW50aWxTdWNjZXNzKCkge1xuXG4gICAgICAgIC8vIGkgc3RpbGwgbmVlZCB0byBjaGFuZ2UgdGhpcy4uLiBjaGFuZ2UgaXQgdG8gYSBmdW5jdGlvbiBhbmQgY2FsbCBpdCBpbiBwbGF5ZXJcbiAgICAgICAgZnVuY3Rpb24gYXNrUGxheWVyRm9yQ29vcmRzKCkge1xuICAgICAgICAgICAgLy8gbWF5YmUgbWFrZSByZWdleCBpbiB0aGUgZnV0dXJlLi4uXG4gICAgICAgICAgICByZXR1cm4gcHJvbXB0KCdjb29yZHMgdG8gYXR0YWNrLCBpbiBcIlt4LHldXCInKS5zcGxpdChcIixcIilcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBpbml0aWFsR3Vlc3NlcyA9IEpTT04uc3RyaW5naWZ5KGVuZW15R2FtZWJvYXJkLmd1ZXNzZWRDb29yZHMpXG4gICAgICAgIGxldCBjdXJyZW50R3Vlc3NlcyA9IGluaXRpYWxHdWVzc2VzO1xuXG4gICAgICAgIHN3aXRjaCAoY3VycmVudFBsYXllcikge1xuICAgICAgICAgICAgY2FzZSBwbGF5ZXI6XG4gICAgICAgICAgICAgICAgLy8gaXMgaXQgY3VzIG9mIHRoaXMgd2hpbGUgbG9vcD9cbiAgICAgICAgICAgICAgICBsZXQgdmFsaWRQbGF5TWFkZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vIHdoaWxlIChpbml0aWFsR3Vlc3NlcyA9PT0gY3VycmVudEd1ZXNzZXMpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoIXZhbGlkUGxheU1hZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coaW5pdGlhbEd1ZXNzZXMgPT09IGN1cnJlbnRHdWVzc2VzKVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnd29yaz8nKVxuICAgICAgICAgICAgICAgICAgICAvLyBsZXQgW2NvbCwgcm93XSA9IGFza1BsYXllckZvckNvb3JkcygpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgW2NvbCwgcm93XSA9IHByb21wdCgnY29vcmRzIHRvIGF0dGFjaywgaW4gXCJ4LHlcIicpLnNwbGl0KFwiLFwiKVxuICAgICAgICAgICAgICAgICAgICAvLyBsZXQgW2NvbCwgcm93XSA9IFsxLDNdXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXIuYXR0YWNrKGVuZW15R2FtZWJvYXJkLCBbY29sLCByb3ddKVxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50R3Vlc3NlcyA9IEpTT04uc3RyaW5naWZ5KGVuZW15R2FtZWJvYXJkLmd1ZXNzZWRDb29yZHMpXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGluaXRpYWxHdWVzc2VzKVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjdXJyZW50R3Vlc3NlcylcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluaXRpYWxHdWVzc2VzICE9PSBjdXJyZW50R3Vlc3NlcykgdmFsaWRQbGF5TWFkZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIGNvbXB1dGVyOlxuICAgICAgICAgICAgICAgIHdoaWxlIChpbml0aWFsR3Vlc3NlcyAhPT0gY3VycmVudEd1ZXNzZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFBsYXllci5yYW5kb21BdHRhY2soZW5lbXlHYW1lYm9hcmQpXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRHdWVzc2VzID0gSlNPTi5zdHJpbmdpZnkoZW5lbXlHYW1lYm9hcmQuZ3Vlc3NlZENvb3JkcylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gbmVlZCB3aGlsZSBsb29wLCB3aGlsZSBnYW1lIGlzbid0IGZpbmlzaGVkXG4gICAgLy8gbmVlZCB0byBwbGF5IGEgbW92ZSwgYW5kIHNvbWVob3cgYWxzbyBnZXQgYXJvdW5kIHByb2JsZW0gb2YgcmV0dXJuaW5nIGlmIGludmFsaWQgbW92ZVxuICAgIGZ1bmN0aW9uIHBsYXlSb3VuZCgpIHtcblxuICAgICAgICBzd2l0Y2ggKGN1cnJlbnRQbGF5ZXIpIHtcbiAgICAgICAgICAgIGNhc2UgcGxheWVyOlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwbGF5ZXInKVxuICAgICAgICAgICAgICAgIHZpc3VhbGlzZUdhbWVib2FyZChlbmVteUdhbWVib2FyZCk7XG4gICAgICAgICAgICAgICAgLy8gbGV0IFtjb2wsIHJvd10gPSBwcm9tcHQoJ2Nvb3JkcyB0byBhdHRhY2ssIGluIFwiW3gseV1cIicpLnNwbGl0KFwiLFwiKVxuICAgICAgICAgICAgICAgIHRyeUF0dGFja1VudGlsU3VjY2VzcygpXG4gICAgICAgICAgICAgICAgY2hlY2tJc0dhbWVPdmVyKGVuZW15R2FtZWJvYXJkKTtcbiAgICAgICAgICAgICAgICBzd2FwUGxheWVyQW5kRW5lbXkoKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjdXJyZW50UGxheWVyKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVuZW15R2FtZWJvYXJkKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgLy9kb2VzIGl0IHN3YXAgYXQgYWxsP1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjYXNlIGNvbXB1dGVyOlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjb21wdXRlcicpXG4gICAgICAgICAgICAgICAgdmlzdWFsaXNlR2FtZWJvYXJkKGVuZW15R2FtZWJvYXJkKTtcbiAgICAgICAgICAgICAgICB0cnlBdHRhY2tVbnRpbFN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgICBjaGVja0lzR2FtZU92ZXIoZW5lbXlHYW1lYm9hcmQpO1xuICAgICAgICAgICAgICAgIHN3YXBQbGF5ZXJBbmRFbmVteSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gdGhlIGN1bHByaXQgZm9yIGluZmluaXRlIHRzdWt1eW9taSBpcyBoZXJlXG4gICAgZnVuY3Rpb24gcGxheUdhbWUoKSB7XG4gICAgICAgIHdoaWxlICghaXNHYW1lT3Zlcikge1xuICAgICAgICAgICAgcGxheVJvdW5kKClcbiAgICAgICAgfVxuXG4gICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdHJ5QXR0YWNrVW50aWxTdWNjZXNzLFxuICAgICAgICAgICAgcGxheUdhbWUsXG4gICAgICAgIH1cbn0iLCJpbXBvcnQgeyBtYWtlR2FtZUNvbnRyb2xsZXIgfSBmcm9tIFwiLi9nYW1lQ29udHJvbGxlclwiO1xuXG5tYWtlR2FtZUNvbnRyb2xsZXIoKS5wbGF5R2FtZSgpIl0sIm5hbWVzIjpbIlNoaXAiLCJjb25zdHJ1Y3RvciIsImxlbmd0aCIsInRoaXMiLCJoaXRzIiwic3VuayIsInNldFN1bmsiLCJoaXQiLCJpc1N1bmsiLCJTcGFjZSIsImhhc1NoaXAiLCJ3YXNHdWVzc2VkIiwibWlzc2VkSGl0Iiwic2hpcCIsIkdhbWVib2FyZCIsImdyaWQiLCJuZXdHcmlkIiwiaSIsInJvdyIsImoiLCJzcXVhcmUiLCJwdXNoIiwiY3JlYXRlR3JpZCIsImFsbFNoaXBDb29yZHMiLCJndWVzc2VkQ29vcmRzIiwiaXNPdXRPZkJvdW5kcyIsImNvbCIsImNoZWNrSWZBbHJlYWR5UGxhY2VkIiwicG9wdWxhdGVTaGlwQ29vcmRzQXJyYXkiLCJwbGFjZVNoaXAiLCJvcmllbnRhdGlvbiIsInN0YXJ0Q29sIiwic3RhcnRSb3ciLCJuZXdTaGlwIiwiaW5pdGlhbGlzZVNoaXAiLCJwbGFjZUFsbFNoaXBzT25Cb2FyZCIsIk1hdGgiLCJyb3VuZCIsInJhbmRvbSIsImZsb29yIiwiZ2V0UG9zaXRpb24iLCJjaGVja1NoaXBFeGlzdHMiLCJnZXRTaGlwIiwiY2hlY2tNaXNzZWRIaXQiLCJjaGVja1dhc0d1ZXNzZWQiLCJjaGVja0lzR2FtZU92ZXIiLCJjb252ZXJ0ZWRBbGxTaGlwQ29vcmRzIiwibWFwIiwiY29vcmQiLCJKU09OIiwic3RyaW5naWZ5IiwiY29udmVydGVkR3Vlc3NlZENvb3JkcyIsImV2ZXJ5Iiwic2hpcENvb3JkIiwiaW5jbHVkZXMiLCJyZWNlaXZlQXR0YWNrIiwiUGxheWVyIiwiY29tcHV0ZXIiLCJhdHRhY2siLCJnYW1lYm9hcmQiLCJDb21wdXRlciIsInN1cGVyIiwicmFuZG9tQXR0YWNrIiwicmFuZG9tQ29sIiwicmFuZG9tUm93IiwicGxheWVyR2FtZWJvYXJkIiwiY29tcHV0ZXJHYW1lYm9hcmQiLCJwbGF5ZXIiLCJjdXJyZW50UGxheWVyIiwiZW5lbXlHYW1lYm9hcmQiLCJpc0dhbWVPdmVyIiwic3dhcFBsYXllckFuZEVuZW15IiwidmlzdWFsaXNlR2FtZWJvYXJkIiwiY29uc29sZSIsImxvZyIsInNwYWNlIiwidHJ5QXR0YWNrVW50aWxTdWNjZXNzIiwiaW5pdGlhbEd1ZXNzZXMiLCJjdXJyZW50R3Vlc3NlcyIsInZhbGlkUGxheU1hZGUiLCJwcm9tcHQiLCJzcGxpdCIsInBsYXlSb3VuZCIsInBsYXlHYW1lIiwibWFrZUdhbWVDb250cm9sbGVyIl0sInNvdXJjZVJvb3QiOiIifQ==