(()=>{"use strict";class s{constructor(s){this.length=s,this.hits=0,this.sunk=!1}setSunk(){this.sunk=!0}hit(){this.hits++}isSunk(){this.length===this.hits&&this.setSunk()}}class t{constructor(){this.hasShip=!1,this.wasGuessed=!1,this.missedHit=!1,this.ship=null}}class i{constructor(){this.grid=function(){let s=[];for(let i=0;i<10;i++){let i=[];for(let s=0;s<10;s++){const s=new t;i.push(s)}s.push(i)}return s}(),this.allShipCoords=[],this.guessedCoords=[]}isOutOfBounds(s,t){return s>9||t>9}checkIfAlreadyPlaced(s,t){return!0===this.grid[t][s].hasShip}populateShipCoordsArray(s,t){this.allShipCoords.push([s,t])}placeShip(t,i,[e,r]){if(this.isOutOfBounds(e,r))return"out of bounds";let o=function(t){if(!(t<1||t>5))return new s(t)}(t);if(o)switch(i){case"horizontal":for(let s=0;s<t;s++){if(this.isOutOfBounds(r,e+s))return"out of bounds";if(this.checkIfAlreadyPlaced(r,e+s))return"position already occupied"}for(let s=0;s<t;s++)this.grid[r][e+s].hasShip=!0,this.grid[r][e+s].ship=o,this.populateShipCoordsArray(e+s,r);break;case"vertical":for(let s=0;s<t;s++){if(this.isOutOfBounds(r+s,e))return"out of bounds";if(this.checkIfAlreadyPlaced(r+s,e))return"position already occupied"}for(let s=0;s<t;s++)this.grid[r+s][e].hasShip=!0,this.grid[r+s][e].ship=o,this.populateShipCoordsArray(e,r+s)}}placeAllShipsOnBoard(){this.placeShip(5,["horizontal","vertical"].Math.round(Math.random()),[Math.floor(10*Math.random()),Math.floor(10*Math.random())])}getPosition(s,t){return this.grid[t][s]}checkShipExists(s,t){return this.grid[t][s].hasShip}getShip(s,t){return this.grid[t][s].ship}checkMissedHit(s,t){return this.grid[t][s].missedHit}checkWasGuessed(s,t){return this.grid[t][s].wasGuessed}checkIsGameOver(){let s=this.allShipCoords.map((s=>JSON.stringify(s))),t=this.guessedCoords.map((s=>JSON.stringify(s)));return s.every((s=>t.includes(s)))}receiveAttack(s,t){if(this.checkWasGuessed(s,t))return"already attacked";this.getPosition(s,t).wasGuessed=!0,this.guessedCoords.push([s,t]),this.checkShipExists(s,t)?(this.getShip(s,t).hit(),this.getShip(s,t).isSunk()):this.getPosition(s,t).missedHit=!0}}class e{constructor(s){}attack(s,[t,i]){s.receiveAttack(t,i)}tryAttackUntilSuccess(s,[t,i]){let e,r=JSON.stringify(s.guessedCoords);for(;r!==e;)this.attack(s,[t,i]),e=JSON.stringify(s.guessedCoords)}}class r extends e{constructor(){super()}randomAttack(s){const t=Math.floor(10*Math.random()),i=Math.floor(10*Math.random());s.checkWasGuessed(t,i)||this.attack(s,[t,i])}}(function(){let s=new i,t=new i;const o=new e,h=new r;let a=o,c=t,n=!1;function l(){a=a===o?h:o,c=c===s?t:s}function u(s){s.checkIsGameOver()&&(n=!0)}function d(s){s.grid.map((s=>{console.log(s.map((s=>!1===s.hasShip&&!1===s.wasGuessed?"_":!1===s.hasShip&&!0===s.wasGuessed?"m":!0===s.hasShip&&!1===s.wasGuessed?"o":!0===s.hasShip&&!0===s.wasGuessed?"x":void 0)))}))}function p(){switch(a){case o:console.log("player"),a.tryAttackUntilSuccess(),d(c),u(c),l();break;case h:console.log("computer"),d(),u(c),l()}}return s.placeShip(5,"vertical",[9,6]),s.placeShip(4,"horizontal",[0,8]),s.placeShip(3,"vertical",[5,6]),s.placeShip(3,"horizontal",[2,3]),s.placeShip(2,"vertical",[1,2]),t.placeShip(5,"vertical",[9,6]),t.placeShip(4,"horizontal",[0,8]),t.placeShip(3,"vertical",[5,6]),t.placeShip(3,"horizontal",[2,3]),t.placeShip(2,"vertical",[1,2]),{tryAttackUntilSuccess:function(){let s,[t,i]=prompt('coords to attack, in "[x,y]"').split(","),e=JSON.stringify(c.guessedCoords);switch(a){case o:for(;e===s;)a.attack(c,[t,i]),s=JSON.stringify(c.guessedCoords);break;case o:for(;e!==s;)a.randomAttack(c),s=JSON.stringify(c.guessedCoords)}},playGame:function(){for(;!n;)p()}}})().playGame()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SzhDLEVBQ0QsS0FBT1IsSUFBbUJELEdBQ3RCVSxFQUFjTixhQUFhTyxHQUMzQlgsRUFBaUJaLEtBQUtDLFVBQVVzQixFQUFlaEQsZUFJL0QsRUF5Q1EwRCxTQVJSLFdBQ0ksTUFBUVQsR0FDSk0sR0FHUixFQUtKLEVDaklBSSxHQUFxQkQsVSIsInNvdXJjZXMiOlsid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL3NoaXAuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL3BsYXllci5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9nYW1lQ29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcbmNsYXNzIFNoaXAge1xuICAgIC8vIGkgbmVlZCB0byBtYWtlIHN1cmUgbGVuZ3RoIGlzIGJldHdlZW4gMSBhbmQgNFxuICAgIGNvbnN0cnVjdG9yKGxlbmd0aCkge1xuICAgICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDtcbiAgICAgICAgdGhpcy5oaXRzID0gMDtcbiAgICAgICAgdGhpcy5zdW5rID0gZmFsc2U7XG4gICAgfVxuXG4gICAgc2V0U3VuaygpIHtcbiAgICAgICAgdGhpcy5zdW5rID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBoaXQoKSB7XG4gICAgICAgIHRoaXMuaGl0cyArK1xuICAgIH1cblxuICAgIGlzU3VuaygpIHtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSB0aGlzLmhpdHMpIHRoaXMuc2V0U3VuaygpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gaW5pdGlhbGlzZVNoaXAobGVuZ3RoKSB7XG4gICAgaWYgKGxlbmd0aCA8IDEgfHwgbGVuZ3RoID4gNSkgcmV0dXJuIFxuICAgIHJldHVybiBuZXcgU2hpcChsZW5ndGgpXG59XG5cblxuZXhwb3J0IHtpbml0aWFsaXNlU2hpcCwgU2hpcH0iLCJpbXBvcnQgeyBTaGlwLCBpbml0aWFsaXNlU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcblxuY2xhc3MgU3BhY2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmhhc1NoaXAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy53YXNHdWVzc2VkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWlzc2VkSGl0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2hpcCA9IG51bGw7XG4gICAgfVxufVxuXG4vLyBub3Qgc3VyZSB3aGVyZSB0byBwdXQgdGhpcyBidXQgbmVlZCB0byBiZSBjYXJlZnVsIGFib3V0IG9yZGluYXRlIG9yZGVyOyBjb2wscm93IHZzIHJvdywgY29sXG4vLyB1c2UgY29sLHJvdyBmb3IgbWV0aG9kIGFyZ3VtZW50cyBhbmQgcHVzaGluZyBpbnRvIHZhcmlhYmxlcyBsaWtlIGd1ZXNzZWRDb29yZHNcbi8vIHVzZSByb3csIGNvbCBmb3IgZ2FtZWJvYXJkIGxvZ2ljXG5jbGFzcyBHYW1lYm9hcmQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBmdW5jdGlvbiBjcmVhdGVHcmlkKCkge1xuICAgICAgICAgICAgbGV0IG5ld0dyaWQgPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpPDEwOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgcm93ID0gW107XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGo8MTA7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzcXVhcmUgPSBuZXcgU3BhY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgcm93LnB1c2goc3F1YXJlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuZXdHcmlkLnB1c2gocm93KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ld0dyaWRcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdyaWQgPSBjcmVhdGVHcmlkKCk7XG4gICAgICAgIHRoaXMuYWxsU2hpcENvb3JkcyA9IFtdO1xuICAgICAgICB0aGlzLmd1ZXNzZWRDb29yZHMgPSBbXTtcbiAgICB9XG5cbiAgICBpc091dE9mQm91bmRzKGNvbCwgcm93KSB7XG4gICAgICAgIGlmIChjb2wgPiA5IHx8IHJvdyA+IDkpIHJldHVybiB0cnVlO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY2hlY2tJZkFscmVhZHlQbGFjZWQoY29sLCByb3cpIHtcbiAgICAgICAgaWYgKHRoaXMuZ3JpZFtyb3ddW2NvbF0uaGFzU2hpcCA9PT0gdHJ1ZSkgcmV0dXJuIHRydWU7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBwb3B1bGF0ZVNoaXBDb29yZHNBcnJheShjb2wsIHJvdykge1xuICAgICAgICB0aGlzLmFsbFNoaXBDb29yZHMucHVzaChbY29sLCByb3ddKVxuICAgIH1cblxuICAgIHBsYWNlU2hpcChsZW5ndGgsIG9yaWVudGF0aW9uLCBbc3RhcnRDb2wsIHN0YXJ0Um93XSkge1xuXG4gICAgICAgIC8vIHRlc3QgaWYgc3RhcnQgY29vcmQgaXMgb3V0IG9mIGJvdW5kc1xuICAgICAgICBpZiAodGhpcy5pc091dE9mQm91bmRzKHN0YXJ0Q29sLCBzdGFydFJvdykpIHJldHVybiAnb3V0IG9mIGJvdW5kcyc7XG5cbiAgICAgICAgbGV0IG5ld1NoaXAgPSBpbml0aWFsaXNlU2hpcChsZW5ndGgpO1xuICAgICAgICBpZiAoIW5ld1NoaXApIHJldHVybjtcblxuICAgICAgICBzd2l0Y2gob3JpZW50YXRpb24pIHtcbiAgICAgICAgICAgIC8vIGlmIG9yaWVudGF0aW9uIGlzIGhvcml6b250YWxcbiAgICAgICAgICAgIC8vIHN0dWZmIGhhcHBlbnMgZnJvbSBsZWZ0IHRvIHJpZ2h0XG4gICAgICAgICAgICBjYXNlICdob3Jpem9udGFsJzpcbiAgICAgICAgICAgICAgICAvL2xvb3AgZm9yIGxlbmd0aCBhbmQgY2hlY2sgaWYgb3V0IG9mIGJvdW5kcyBvciBhbHJlYWR5IG9jY3VwaWVkOyBpZiBzbyBjYW5jZWwgZXhlY3V0aW9uXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGk8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT3V0T2ZCb3VuZHMoc3RhcnRSb3csIHN0YXJ0Q29sICsgaSkpIHJldHVybiAnb3V0IG9mIGJvdW5kcyc7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoZWNrSWZBbHJlYWR5UGxhY2VkKHN0YXJ0Um93LCBzdGFydENvbCArIGkpKSByZXR1cm4gJ3Bvc2l0aW9uIGFscmVhZHkgb2NjdXBpZWQnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGVsc2UsIGxvb3AgYWxvbmcgdGhlIHJvdyAob2NjdXB5IGNvbHVtbnMgb2YgdGhlIHNhbWUgcm93KVxuICAgICAgICAgICAgICAgIC8vIGF0IGVhY2ggZ3JpZCBzcXVhcmUsIG9jY3VweSB3aXRoIHNoaXAgSURcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaTwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRbc3RhcnRSb3ddW3N0YXJ0Q29sICsgaV0uaGFzU2hpcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgLy8gdGhpcyBtYXkgYmUgbm90IGdvb2RcbiAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRbc3RhcnRSb3ddW3N0YXJ0Q29sICsgaV0uc2hpcCA9IG5ld1NoaXA7XG5cbiAgICAgICAgICAgICAgICAgICAvLyBtYXkgYmUgYW4gZXJyb3IgaW4gdGhlIGNvbCBhbmQgcm93IGFyZ3VtZW50IG9yZGVyXG4gICAgICAgICAgICAgICAgICAgLy9ub3QgdW5kZXJzdGFuZC4uLlxuICAgICAgICAgICAgICAgICAgIC8vIGNoYW5nZSB0aGlzIGZyb20gc3BhY2VzLCB0byBjb29yZGluYXRlcywgY3VzIGkgZG9uJ3Qgd2FudCBhIGNvcHkgb2Ygb2JqZWN0c1xuICAgICAgICAgICAgICAgICAgIHRoaXMucG9wdWxhdGVTaGlwQ29vcmRzQXJyYXkoc3RhcnRDb2wgKyBpLCBzdGFydFJvdylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWtcblxuICAgICAgICAgICAgLy8gaWYgb3JpZW50YXRpb24gaXMgdmVydGljYWxcbiAgICAgICAgICAgIC8vIHNoaXAgaXMgY3JlYXRlZCBmcm9tIGJvdHRvbSB0byB0b3BcbiAgICAgICAgICAgIC8vIHJvd1swXSBpcyBib3R0b20sIHJvd1s5XSB0byB0b3AsIGR1ZSB0byB0aGUgYDkgLSBgXG4gICAgICAgICAgICBjYXNlICd2ZXJ0aWNhbCc6XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGk8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzT3V0T2ZCb3VuZHMoc3RhcnRSb3cgKyBpLCBzdGFydENvbCkpIHJldHVybiAnb3V0IG9mIGJvdW5kcydcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hlY2tJZkFscmVhZHlQbGFjZWQoc3RhcnRSb3cgKyBpLCBzdGFydENvbCkpIHJldHVybiAncG9zaXRpb24gYWxyZWFkeSBvY2N1cGllZCdcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBhbmQgdGhlbiBwdXQgc3R1ZmYgYWxvbmcgdGhlIGNvbHVtbiAob2NjdXB5IHJvd3Mgb2YgdGhlIHNhbWUgY29sdW1uKVxuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpPCBsZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmdyaWRbc3RhcnRSb3cgKyBpXVtzdGFydENvbF0uaGFzU2hpcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ3JpZFtzdGFydFJvdyArIGldW3N0YXJ0Q29sXS5zaGlwID0gbmV3U2hpcDtcblxuICAgICAgICAgICAgICAgICAgIC8vIG1heSBiZSBhbiBlcnJvciBpbiB0aGUgY29sIGFuZCByb3cgYXJndW1lbnQgb3JkZXJcbiAgICAgICAgICAgICAgICAgICAvLyBjaGFuZ2UgdGhpcyBmcm9tIHNwYWNlcywgdG8gY29vcmRpbmF0ZXMsIGN1cyBpIGRvbid0IHdhbnQgYSBjb3B5IG9mIG9iamVjdHNcbiAgICAgICAgICAgICAgICAgICB0aGlzLnBvcHVsYXRlU2hpcENvb3Jkc0FycmF5KHN0YXJ0Q29sLCBzdGFydFJvdyArIGkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB3aGF0IGRvIGkgcGxhY2Ugb24gdGhlIGJvYXJkP1xuICAgIC8vIDUgcGllY2VzIGkgdGhpbmtcbiAgICAvLyBobW0gaG93IGRvIGkga2VlcCB0cnlpbmcgdG8gcGxhY2UgdGhlIHNoaXBzIGlmIHRoZXkgYXJlIG91dCBvZiBib3VuZHMgb3IgYWxyZWFkeSBwYWxjZWQ/XG4gICAgLy8gc2hvdWxkIGkganVzdCBwdXQgZWFjaCBpbiBhIHdoaWxlIGxvb3A/IG9yIHVzZSByZWN1cnNpb24/XG5cbiAgICBwbGFjZUFsbFNoaXBzT25Cb2FyZCgpIHtcbiAgICAgICAgLy8gbmVlZCB0byBwdXQgc2hpcHMgaG9yaXpvbnRhbGx5IG9yIHZlcnRpY2FsbHkgcmFuZG9tbHlcbiAgICAgICAgLy8gdGhpcyB3aWxsIG9ubHkgZ2VuZXJhdGUgb25lIG9yaWVudGF0aW9uLi4uIG1ha2UgaXQgYSBzZXBhcmF0ZSBmdW5jdGlvblxuICAgICAgICBmdW5jdGlvbiBnZW5lcmF0ZVJhbmRvbU9yaWVudGF0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIFsnaG9yaXpvbnRhbCcsICd2ZXJ0aWNhbCddLk1hdGgucm91bmQoTWF0aC5yYW5kb20oKSlcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlUmFuZG9tQ29vcmRpbmF0ZXMoKSB7XG4gICAgICAgICAgICBjb25zdCByYW5kb21Db2wgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMClcbiAgICAgICAgICAgIGNvbnN0IHJhbmRvbVJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxuICAgICAgICAgICAgcmV0dXJuIFtyYW5kb21Db2wsIHJhbmRvbVJvd11cbiAgICAgICAgfVxuXG5cbiAgICAgICAgLy9ob3cgZG8gaSBwcmV2ZW50IGZhaWx1cmUgdG8gcGxhY2UgYSBzaGlwPyBpcyBpdCBcbiAgICAgICAgLy8gdGhlcmUgYXJlIHNldmVyYWwgb3B0aW9ucy4uLiBcbiAgICAgICAgLy8gd2hpbGUgKCkge31cbiAgICAgICAgdGhpcy5wbGFjZVNoaXAoNSwgZ2VuZXJhdGVSYW5kb21PcmllbnRhdGlvbigpLCBnZW5lcmF0ZVJhbmRvbUNvb3JkaW5hdGVzKCkpXG5cbiAgICB9XG5cbiAgICBnZXRQb3NpdGlvbihjb2wsIHJvdykge1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkW3Jvd11bY29sXVxuICAgIH1cblxuICAgIGNoZWNrU2hpcEV4aXN0cyhjb2wsIHJvdykge1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkW3Jvd11bY29sXS5oYXNTaGlwXG4gICAgfVxuXG5cbiAgICBnZXRTaGlwKGNvbCwgcm93KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdyaWRbcm93XVtjb2xdLnNoaXBcbiAgICB9XG5cbiAgICBjaGVja01pc3NlZEhpdChjb2wsIHJvdykge1xuICAgICAgICByZXR1cm4gdGhpcy5ncmlkW3Jvd11bY29sXS5taXNzZWRIaXRcbiAgICB9XG5cbiAgICBjaGVja1dhc0d1ZXNzZWQoY29sLCByb3cpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ3JpZFtyb3ddW2NvbF0ud2FzR3Vlc3NlZFxuICAgIH1cblxuICAgIC8vIGNvbXBhcmUgc3RyaW5naWZpZWQgc2hpcCBjb29yZHMgdG8gdGhlIGd1ZXNzZWQgY29vcmRzLCBhbmQgcmV0dXJuIHRydWUgaWYgYWxsIHNoaXAgY29vcmRzIGFyZSBndWVzc2VkLlxuICAgIGNoZWNrSXNHYW1lT3ZlcigpIHtcbiAgICAgICAgbGV0IGNvbnZlcnRlZEFsbFNoaXBDb29yZHMgPSB0aGlzLmFsbFNoaXBDb29yZHMubWFwKGNvb3JkID0+IEpTT04uc3RyaW5naWZ5KGNvb3JkKSlcbiAgICAgICAgbGV0IGNvbnZlcnRlZEd1ZXNzZWRDb29yZHMgPSB0aGlzLmd1ZXNzZWRDb29yZHMubWFwKGNvb3JkID0+IEpTT04uc3RyaW5naWZ5KGNvb3JkKSlcbiAgICAgICAgLy8gaWYgKGNvbnZlcnRlZEFsbFNoaXBDb29yZHMuZXZlcnkoc2hpcENvb3JkID0+IGNvbnZlcnRlZEd1ZXNzZWRDb29yZHMuaW5jbHVkZXMoc2hpcENvb3JkKSkpIHtcbiAgICAgICAgLy8gICAgIHRoaXMuaXNHYW1lT3ZlciA9IHRydWU7XG4gICAgICAgIC8vIH1cbiAgICAgICAgcmV0dXJuIGNvbnZlcnRlZEFsbFNoaXBDb29yZHMuZXZlcnkoc2hpcENvb3JkID0+IGNvbnZlcnRlZEd1ZXNzZWRDb29yZHMuaW5jbHVkZXMoc2hpcENvb3JkKSlcbiAgICB9XG5cbiAgICByZWNlaXZlQXR0YWNrKGNvbCwgcm93KSB7XG4gICAgICAgIC8vIGZpcnN0LCBjaGVjayBpZiBwb3NpdGlvbiBpcyBhbHJlYWR5IGd1ZXNzZWRcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tXYXNHdWVzc2VkKGNvbCwgcm93KSkgcmV0dXJuICdhbHJlYWR5IGF0dGFja2VkJztcbiAgICAgICAgLy8gaWYgbm90IGd1ZXNzZWQsIHRoZW4gbWFyayBhcyBndWVzc2VkXG4gICAgICAgIHRoaXMuZ2V0UG9zaXRpb24oY29sLCByb3cpLndhc0d1ZXNzZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLmd1ZXNzZWRDb29yZHMucHVzaChbY29sLCByb3ddKVxuXG4gICAgICAgIC8vIGlmIG5vdCwgY2hlY2sgaWYgdGhlcmUgaXMgYSBzaGlwIHRoZXJlXG4gICAgICAgIGlmICh0aGlzLmNoZWNrU2hpcEV4aXN0cyhjb2wsIHJvdykpIHtcbiAgICAgICAgICAgIC8vIGlmIHRoZXJlIGlzLCB0aGVuIGlkZW50aWZ5IHRoZSBzaGlwXG4gICAgICAgICAgICAvLyB0aGVuIGhpdCB0aGUgc2hpcFxuICAgICAgICAgICAgdGhpcy5nZXRTaGlwKGNvbCwgcm93KS5oaXQoKVxuICAgICAgICAgICAgLy8gdGhlbiBjaGVjayBpZiBzaGlwIGlzIHN1bmtcbiAgICAgICAgICAgIHRoaXMuZ2V0U2hpcChjb2wsIHJvdykuaXNTdW5rKCk7XG5cbiAgICAgICAgICAgIC8vIHRoZW4gY2hlY2sgaWYgYWxsIHNoaXBzIGFyZSBoaXQsIGJ5IGNvbXBhcmluZyBhbGxTaGlwQ29vcmRzIGFuZCBndWVzc2VkQ29vcmRzIGFycmF5cyBcbiAgICAgICAgICAgIC8vIHRoaXMuY2hlY2tJc0dhbWVPdmVyKCk7XG5cbiAgICAgICAgfVxuICAgICAgICAvLyBpZiB0aGVyZSBpc24ndCBhIHNoaXAsIHRoZW4gbWFyayB0aGUgcGxhY2Ugd2l0aCBtaXNzZWRIaXRcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmdldFBvc2l0aW9uKGNvbCwgcm93KS5taXNzZWRIaXQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgXG59XG5leHBvcnQge0dhbWVib2FyZH0iLCJleHBvcnQgY2xhc3MgUGxheWVyIHtcbiAgICBjb25zdHJ1Y3Rvcihjb21wdXRlcikge1xuICAgIH1cblxuICAgIC8vIGhtbSBpcyB0aGlzIG9rYXk/IGRvIGkgbmVlZCB0byBpbXBvcnQgZ2FtZWJvYXJkPyBzdXJlbHkgbm90Li4uIHRoYXQgd291bGQgYmUgYXdmdWxcbiAgICAvLyBpIGp1c3QgY2FsbGVkIHRoZSByZWNlaXZlQXR0YWNrIG1ldGhvZCBvbiB0aGUgZ2FtZWJvYXJkIGFyZ3VtZW50Li4uIGlzIHRoaXMgYSBiYWQgdGhpbmc/XG4gICAgYXR0YWNrKGdhbWVib2FyZCwgW2NvbCwgcm93XSkge1xuICAgICAgICBnYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhjb2wsIHJvdylcbiAgICB9XG5cbiAgICAvLyBhY3R1YWxseSB0aGlzIGNhbid0IGJlIGluIGhlcmUuLi4gY3VzIHRoZSBjb2wgYW5kIHJvdyBkb24ndCBjaGFuZ2UuLi4gdGhleSBnb3R0YSBjaGFuZ2VcbiAgICB0cnlBdHRhY2tVbnRpbFN1Y2Nlc3MoZ2FtZWJvYXJkLCBbY29sLCByb3ddKSB7XG4gICAgICAgIGxldCBpbml0aWFsR3Vlc3NlcyA9IEpTT04uc3RyaW5naWZ5KGdhbWVib2FyZC5ndWVzc2VkQ29vcmRzKVxuICAgICAgICBsZXQgY3VycmVudEd1ZXNzZXM7XG4gICAgICAgIHdoaWxlIChpbml0aWFsR3Vlc3NlcyAhPT0gY3VycmVudEd1ZXNzZXMpIHtcbiAgICAgICAgICAgIHRoaXMuYXR0YWNrKGdhbWVib2FyZCwgW2NvbCwgcm93XSlcbiAgICAgICAgICAgIGN1cnJlbnRHdWVzc2VzID0gSlNPTi5zdHJpbmdpZnkoZ2FtZWJvYXJkLmd1ZXNzZWRDb29yZHMpXG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8vIGFoaGggZG9uJ3QgdGhpbmsgdGhpcyB3b3JrcywsLCBnb3R0YSB1c2Ugc3VwZXI/XG5leHBvcnQgY2xhc3MgQ29tcHV0ZXIgZXh0ZW5kcyBQbGF5ZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpXG4gICAgfVxuXG4gICAgcmFuZG9tQXR0YWNrKGdhbWVib2FyZCkge1xuICAgICAgICAvLyB0YWtlIHJhbmRvbSBudW1iZXJzIGZvciBjb2x1bW4gYW5kIHJvd1xuICAgICAgICBjb25zdCByYW5kb21Db2wgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMClcbiAgICAgICAgY29uc3QgcmFuZG9tUm93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApXG5cbiAgICAgICAgLy90aGVuIGNoZWNrIGlmIGhhcyBiZWVuIGF0dGFja2VkLFxuICAgICAgICBpZihnYW1lYm9hcmQuY2hlY2tXYXNHdWVzc2VkKHJhbmRvbUNvbCwgcmFuZG9tUm93KSkgcmV0dXJuXG5cbiAgICAgICAgLy90aGVuIGNhbGwgYXR0YWNrXG4gICAgICAgIHRoaXMuYXR0YWNrKGdhbWVib2FyZCwgW3JhbmRvbUNvbCwgcmFuZG9tUm93XSlcbiAgICB9XG59IiwiaW1wb3J0IHsgR2FtZWJvYXJkIH0gZnJvbSBcIi4vZ2FtZWJvYXJkXCI7XG5pbXBvcnQgeyBQbGF5ZXIsIENvbXB1dGVyIH0gZnJvbSBcIi4vcGxheWVyXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlR2FtZUNvbnRyb2xsZXIoKSB7XG4gICAgLy8gYXQgc29tZSBwb2ludCwgd2lsbCBuZWVkIHRvIGRldmVsb3AgZnVuY3Rpb24gdG8gcGxhY2VBbGxTaGlwcywgd2hpY2ggXG4gICAgLy8gbmVlZHMgdG8gZ2V0IGFyb3VuZCB0aGUgcHJvYmxlbSBvZiBsb29waW5nIHBsYWNlU2hpcCB1bnRpbCBpdCBpcyBhY3R1YWxseSBwbGFjZWRcblxuICAgIC8vIGRvIGkgdXNlIFxuICAgIGxldCBwbGF5ZXJHYW1lYm9hcmQgPSBuZXcgR2FtZWJvYXJkKCk7XG4gICAgbGV0IGNvbXB1dGVyR2FtZWJvYXJkID0gbmV3IEdhbWVib2FyZCgpO1xuXG4gICAgY29uc3QgcGxheWVyID0gbmV3IFBsYXllcigpO1xuICAgIGNvbnN0IGNvbXB1dGVyID0gbmV3IENvbXB1dGVyKCk7XG5cbiAgICBsZXQgY3VycmVudFBsYXllciA9IHBsYXllcjtcbiAgICBsZXQgZW5lbXlHYW1lYm9hcmQgPSBjb21wdXRlckdhbWVib2FyZFxuXG4gICAgbGV0IGlzR2FtZU92ZXIgPSBmYWxzZTtcblxuICAgIC8vIHdhaXQsIGlzIHRoaXMgbW9ja2luZz8gaXQgbWF5IGJlIHdvcnRoIGEgcmVhZCBhZ2Fpbi4uLlxuICAgIHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoNSwgJ3ZlcnRpY2FsJywgWzksNl0pO1xuICAgIHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoNCwgJ2hvcml6b250YWwnLCBbMCw4XSk7XG4gICAgcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcCgzLCAndmVydGljYWwnLCBbNSw2XSk7XG4gICAgcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcCgzLCAnaG9yaXpvbnRhbCcsIFsyLDNdKTtcbiAgICBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDIsICd2ZXJ0aWNhbCcsIFsxLDJdKTtcblxuICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcCg1LCAndmVydGljYWwnLCBbOSw2XSk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDQsICdob3Jpem9udGFsJywgWzAsOF0pO1xuICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcCgzLCAndmVydGljYWwnLCBbNSw2XSk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKDMsICdob3Jpem9udGFsJywgWzIsM10pO1xuICAgIGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcCgyLCAndmVydGljYWwnLCBbMSwyXSk7XG5cbiAgICAvLyBpIHdpbGwgbmVlZCBET00gaW4gYW5vdGhlciBzZXBhcmF0ZSBmaWxlXG5cbiAgICAvLyB3aWxsIG5lZWQgdG8gdGVzdCBlYWNoIG9mIHRoZXNlLi4uXG4gICAgZnVuY3Rpb24gc3dhcFBsYXllckFuZEVuZW15KCkge1xuICAgICAgICBjdXJyZW50UGxheWVyID09PSBwbGF5ZXIgPyBjdXJyZW50UGxheWVyID0gY29tcHV0ZXIgOiBjdXJyZW50UGxheWVyID0gcGxheWVyO1xuICAgICAgICBlbmVteUdhbWVib2FyZCA9PT0gcGxheWVyR2FtZWJvYXJkID8gZW5lbXlHYW1lYm9hcmQgPSBjb21wdXRlckdhbWVib2FyZCA6IGVuZW15R2FtZWJvYXJkID0gcGxheWVyR2FtZWJvYXJkO1xuICAgIH1cblxuICAgIC8vIGlmIGdhbWUgaXMgb3Zlciwgc2V0IHRoZSBpc0dhbWVPdmVyIHZhcmlhYmxlIHRvIHRydWUgdG8gZW5kIHRoZSB3aGlsZSBsb29wLlxuICAgIGZ1bmN0aW9uIGNoZWNrSXNHYW1lT3ZlcihnYW1lYm9hcmQpIHtcbiAgICAgICAgaWYgKGdhbWVib2FyZC5jaGVja0lzR2FtZU92ZXIoKSkgaXNHYW1lT3ZlciA9IHRydWU7XG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIHZpc3VhbGlzZUdhbWVib2FyZChnYW1lYm9hcmQpIHtcbiAgICAgICAgLy8gaG93IGRvIGkgY29udmVydCB0aGUgZ2FtZWJvYXJkIHdpdGggdGhlIHNwYWNlcywgaW50byBhIGNvbnNvbGUgbG9nP1xuICAgICAgICAvLyBtYXliZSBhIGRvdWJsZSBtYXBcbiAgICAgICAgZ2FtZWJvYXJkLmdyaWQubWFwKHJvdyA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIHJvdy5tYXAoc3BhY2UgPT4ge1xuICAgICAgICAgICAgICAgIGlmKHNwYWNlLmhhc1NoaXAgPT09IGZhbHNlICYmIHNwYWNlLndhc0d1ZXNzZWQgPT09IGZhbHNlKSByZXR1cm4gJ18nXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoc3BhY2UuaGFzU2hpcCA9PT0gZmFsc2UgJiYgc3BhY2Uud2FzR3Vlc3NlZCA9PT0gdHJ1ZSkgcmV0dXJuICdtJ1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNwYWNlLmhhc1NoaXAgPT09IHRydWUgJiYgc3BhY2Uud2FzR3Vlc3NlZCA9PT0gZmFsc2UpIHJldHVybiAnbydcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChzcGFjZS5oYXNTaGlwID09PSB0cnVlICYmIHNwYWNlLndhc0d1ZXNzZWQgPT09IHRydWUpIHJldHVybiAneCdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gaSBuZWVkIHRvIGNvbnNvbGUgbG9nIGVhY2ggcm93XG4gICAgICAgIFxuXG4gICAgfVxuXG4gICAgLy8gY2hlY2sgaWYgdGhlIGd1ZXNzZWRDb29yZHMgYXJyYXkgY2hhbmdlczsgaWYgc28sIHRoZSBhdHRhY2sgd2FzIHN1Y2Nlc3NmdWwuXG4gICAgLy8gdGhpcyBhYnNvbHV0ZWx5IG11c3QgZ2V0IHRlc3RlZC4uLlxuICAgIGZ1bmN0aW9uIHRyeUF0dGFja1VudGlsU3VjY2VzcygpIHtcblxuICAgICAgICBsZXQgW2NvbCwgcm93XSA9IHByb21wdCgnY29vcmRzIHRvIGF0dGFjaywgaW4gXCJbeCx5XVwiJykuc3BsaXQoXCIsXCIpXG4gICAgICAgIGxldCBpbml0aWFsR3Vlc3NlcyA9IEpTT04uc3RyaW5naWZ5KGVuZW15R2FtZWJvYXJkLmd1ZXNzZWRDb29yZHMpXG4gICAgICAgIGxldCBjdXJyZW50R3Vlc3NlcztcblxuICAgICAgICBzd2l0Y2ggKGN1cnJlbnRQbGF5ZXIpIHtcbiAgICAgICAgICAgIGNhc2UgcGxheWVyOlxuICAgICAgICAgICAgICAgIHdoaWxlIChpbml0aWFsR3Vlc3NlcyA9PT0gY3VycmVudEd1ZXNzZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFBsYXllci5hdHRhY2soZW5lbXlHYW1lYm9hcmQsIFtjb2wsIHJvd10pXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRHdWVzc2VzID0gSlNPTi5zdHJpbmdpZnkoZW5lbXlHYW1lYm9hcmQuZ3Vlc3NlZENvb3JkcylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgcGxheWVyOlxuICAgICAgICAgICAgICAgIHdoaWxlIChpbml0aWFsR3Vlc3NlcyAhPT0gY3VycmVudEd1ZXNzZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFBsYXllci5yYW5kb21BdHRhY2soZW5lbXlHYW1lYm9hcmQpXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRHdWVzc2VzID0gSlNPTi5zdHJpbmdpZnkoZW5lbXlHYW1lYm9hcmQuZ3Vlc3NlZENvb3JkcylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gbmVlZCB3aGlsZSBsb29wLCB3aGlsZSBnYW1lIGlzbid0IGZpbmlzaGVkXG4gICAgLy8gbmVlZCB0byBwbGF5IGEgbW92ZSwgYW5kIHNvbWVob3cgYWxzbyBnZXQgYXJvdW5kIHByb2JsZW0gb2YgcmV0dXJuaW5nIGlmIGludmFsaWQgbW92ZVxuICAgIGZ1bmN0aW9uIHBsYXlSb3VuZCgpIHtcblxuICAgICAgICBzd2l0Y2ggKGN1cnJlbnRQbGF5ZXIpIHtcbiAgICAgICAgICAgIGNhc2UgcGxheWVyOlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdwbGF5ZXInKVxuICAgICAgICAgICAgICAgIC8vIGxldCBbY29sLCByb3ddID0gcHJvbXB0KCdjb29yZHMgdG8gYXR0YWNrLCBpbiBcIlt4LHldXCInKS5zcGxpdChcIixcIilcblxuICAgICAgICAgICAgICAgIC8vIGhvdyBkbyBpIG1ha2UgaXQgc28gdGhhdCBpZiBhbiBpbnZhbGlkIG1vdmUgaXMgbWFkZSwgdHJ5IGFnYWluP1xuICAgICAgICAgICAgICAgIC8vIGRvIGkgaW1wbGVtZW50IHRoYXQgaGVyZT9cbiAgICAgICAgICAgICAgICAvLyB0aGVyZSBhcmUgdGhyZWUgcGxhY2VzIGkgY291bGQgaW1wbGVtZW50IGl0OyByZWNlaXZlQXR0YWNrKCksIGF0dGFjaygpLCBvciBwbGF5Um91bmQoKVxuICAgICAgICAgICAgICAgIC8vIGkgbmVlZCB0byBtYWtlIHVzZSBvZiBzb21ldGhpbmc/IGVpdGhlciB0aGUgcmV0dXJuIHN0YXRlbWVudCwgb3IgdGhlIGdhbWVib2FyZCBjaGFuZ2luZz8gb3IgbWF5YmUgd2FzR3Vlc3NlZCBjaGFuZ2luZz9cblxuICAgICAgICAgICAgICAgIC8vIGN1cnJlbnRQbGF5ZXIuYXR0YWNrKGVuZW15R2FtZWJvYXJkLCBbY29sLCByb3ddKVxuICAgICAgICAgICAgICAgIGN1cnJlbnRQbGF5ZXIudHJ5QXR0YWNrVW50aWxTdWNjZXNzKClcbiAgICAgICAgICAgICAgICAvLyBtYXliZSBwcmludCB0aGUgYm9hcmQuLi4/XG4gICAgICAgICAgICAgICAgdmlzdWFsaXNlR2FtZWJvYXJkKGVuZW15R2FtZWJvYXJkKTtcbiAgICAgICAgICAgICAgICBjaGVja0lzR2FtZU92ZXIoZW5lbXlHYW1lYm9hcmQpO1xuICAgICAgICAgICAgICAgIHN3YXBQbGF5ZXJBbmRFbmVteSgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBjYXNlIGNvbXB1dGVyOlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjb21wdXRlcicpXG4gICAgICAgICAgICAgICAgdmlzdWFsaXNlR2FtZWJvYXJkKCk7XG4gICAgICAgICAgICAgICAgLy8gY3VycmVudFBsYXllci50cnlBdHRhY2tVbnRpbFN1Y2Nlc3MoZW5lbXlHYW1lYm9hcmQpO1xuICAgICAgICAgICAgICAgIGNoZWNrSXNHYW1lT3ZlcihlbmVteUdhbWVib2FyZCk7XG4gICAgICAgICAgICAgICAgc3dhcFBsYXllckFuZEVuZW15KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIGZ1bmN0aW9uIHBsYXlHYW1lKCkge1xuICAgICAgICB3aGlsZSAoIWlzR2FtZU92ZXIpIHtcbiAgICAgICAgICAgIHBsYXlSb3VuZCgpXG4gICAgICAgIH1cblxuICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRyeUF0dGFja1VudGlsU3VjY2VzcyxcbiAgICAgICAgICAgIHBsYXlHYW1lLFxuICAgICAgICB9XG59IiwiaW1wb3J0IHsgbWFrZUdhbWVDb250cm9sbGVyIH0gZnJvbSBcIi4vZ2FtZUNvbnRyb2xsZXJcIjtcblxubWFrZUdhbWVDb250cm9sbGVyKCkucGxheUdhbWUoKSJdLCJuYW1lcyI6WyJTaGlwIiwiY29uc3RydWN0b3IiLCJsZW5ndGgiLCJ0aGlzIiwiaGl0cyIsInN1bmsiLCJzZXRTdW5rIiwiaGl0IiwiaXNTdW5rIiwiU3BhY2UiLCJoYXNTaGlwIiwid2FzR3Vlc3NlZCIsIm1pc3NlZEhpdCIsInNoaXAiLCJHYW1lYm9hcmQiLCJncmlkIiwibmV3R3JpZCIsImkiLCJyb3ciLCJqIiwic3F1YXJlIiwicHVzaCIsImNyZWF0ZUdyaWQiLCJhbGxTaGlwQ29vcmRzIiwiZ3Vlc3NlZENvb3JkcyIsImlzT3V0T2ZCb3VuZHMiLCJjb2wiLCJjaGVja0lmQWxyZWFkeVBsYWNlZCIsInBvcHVsYXRlU2hpcENvb3Jkc0FycmF5IiwicGxhY2VTaGlwIiwib3JpZW50YXRpb24iLCJzdGFydENvbCIsInN0YXJ0Um93IiwibmV3U2hpcCIsImluaXRpYWxpc2VTaGlwIiwicGxhY2VBbGxTaGlwc09uQm9hcmQiLCJNYXRoIiwicm91bmQiLCJyYW5kb20iLCJmbG9vciIsImdldFBvc2l0aW9uIiwiY2hlY2tTaGlwRXhpc3RzIiwiZ2V0U2hpcCIsImNoZWNrTWlzc2VkSGl0IiwiY2hlY2tXYXNHdWVzc2VkIiwiY2hlY2tJc0dhbWVPdmVyIiwiY29udmVydGVkQWxsU2hpcENvb3JkcyIsIm1hcCIsImNvb3JkIiwiSlNPTiIsInN0cmluZ2lmeSIsImNvbnZlcnRlZEd1ZXNzZWRDb29yZHMiLCJldmVyeSIsInNoaXBDb29yZCIsImluY2x1ZGVzIiwicmVjZWl2ZUF0dGFjayIsIlBsYXllciIsImNvbXB1dGVyIiwiYXR0YWNrIiwiZ2FtZWJvYXJkIiwidHJ5QXR0YWNrVW50aWxTdWNjZXNzIiwiY3VycmVudEd1ZXNzZXMiLCJpbml0aWFsR3Vlc3NlcyIsIkNvbXB1dGVyIiwic3VwZXIiLCJyYW5kb21BdHRhY2siLCJyYW5kb21Db2wiLCJyYW5kb21Sb3ciLCJwbGF5ZXJHYW1lYm9hcmQiLCJjb21wdXRlckdhbWVib2FyZCIsInBsYXllciIsImN1cnJlbnRQbGF5ZXIiLCJlbmVteUdhbWVib2FyZCIsImlzR2FtZU92ZXIiLCJzd2FwUGxheWVyQW5kRW5lbXkiLCJ2aXN1YWxpc2VHYW1lYm9hcmQiLCJjb25zb2xlIiwibG9nIiwic3BhY2UiLCJwbGF5Um91bmQiLCJwcm9tcHQiLCJzcGxpdCIsInBsYXlHYW1lIiwibWFrZUdhbWVDb250cm9sbGVyIl0sInNvdXJjZVJvb3QiOiIifQ==